<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SaaS Pro Valuation - Comprehensive Business Evaluation</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #38b2ac 0%, #2d3748 100%);
    }
    .btn-primary {
      @apply bg-teal-500 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300;
    }
    .btn-primary:hover {
      @apply bg-teal-600;
    }
    .btn-secondary {
      @apply bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300;
    }
    .btn-secondary:hover {
      @apply bg-yellow-600;
    }
    .step-hidden {
      display: none !important;
    }
    .step-visible {
      display: block !important;
    }
    [data-tooltip]:hover:after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #2D3748;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 10;
    }
    .valuation-box {
      max-width: 700px;
      margin: 0 auto;
      background-color: #f9fafb;
      border: 2px solid #d1d5db;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 10px rgb(0 0 0 / 0.05);
    }
    .explanation-box {
      background: #e5e7eb;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      padding: 0;
      margin-top: 0;
      font-size: 0.875rem;
      color: #374151;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease, margin-top 0.3s ease;
    }
    .explanation-box.expanded {
      max-height: 500px;
      padding: 0.75rem 1rem;
      margin-top: 0.375rem;
    }
  </style>
</head>
<body class="font-sans bg-gray-50 min-h-screen flex flex-col">
  <!-- HEADER -->
  <header class="bg-gray-800 text-white py-3 sticky top-0 z-50 shadow">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <div class="text-xl font-bold">
        <a href="index.html">SaaS Valuation App</a>
      </div>
      <nav class="hidden md:flex space-x-4">
        <a href="index.html#valuation">Free Self Valuation</a>
        <a href="index.html#resources">About</a>
        <a href="index.html#pricing">Pricing</a>
        <a href="blog.html">Resources</a>
      </nav>
      <button id="menu-toggle" class="md:hidden focus:outline-none" aria-label="Toggle Menu">
        <i class="fas fa-bars text-xl"></i>
      </button>
    </div>
    <div id="mobile-menu" class="md:hidden hidden px-4 pb-4">
      <nav class="flex flex-col space-y-2 mt-3">
        <a href="#valuation" class="hover:text-teal-400 text-sm">Self Valuation</a>
        <a href="#data-room" class="hover:text-teal-400 text-sm">AI Data Room</a>
        <a href="#pricing" class="hover:text-teal-400 text-sm">Pricing</a>
        <a href="#resources" class="hover:text-teal-400 text-sm">Resources</a>
      </nav>
    </div>
  </header>

  <!-- INTRO -->
  <main class="flex-grow">
    <section class="gradient-bg text-white py-16">
      <div class="container mx-auto px-4 text-center max-w-3xl">
        <h1 class="text-3xl md:text-4xl font-bold mb-3">Pro Valuation: Comprehensive SaaS Business Evaluation</h1>
        <p class="text-base md:text-lg opacity-90">
          Get a detailed valuation of your SaaS business with advanced metrics and insights.
        </p>
      </div>
    </section>

    <!-- PRO VALUATION FORM -->
    <section id="pro-valuation" class="py-12 bg-gray-50">
      <div class="container mx-auto px-4 max-w-3xl">
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-2">Pro Valuation Tool</h2>
          <p class="text-base text-gray-600 max-w-xl mx-auto">
            Answer questions step-by-step to get a detailed valuation report with actionable insights.
          </p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-6">
          <div class="relative pt-1">
            <div class="overflow-hidden h-1.5 mb-2 text-xs flex rounded bg-gray-200">
              <div
                id="progress-fill"
                class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-teal-500"
                style="width: 8.33%"
              ></div>
            </div>
            <p class="text-center text-gray-600 text-sm">
              Step <span id="current-step">1</span> of 8
            </p>
          </div>
        </div>

        <div class="valuation-box">
          <!-- Step 1: Select Valuation Methods -->
          <div id="step-1" class="step step-visible" data-step="1">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 1: Select Valuation Methods</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Choose up to 3 valuation methods that best fit your SaaS business.
              <span data-tooltip="Select methods matching your business model." class="text-teal-500 underline cursor-pointer">Learn more</span>
            </p>
            <div class="space-y-3">
              <label class="flex items-center">
                <input type="checkbox" id="method-multiplier" value="multiplier" class="form-checkbox h-5 w-5 text-teal-500" />
                <span class="ml-2">Revenue Multiplier</span>
                <button type="button" class="text-teal-500 underline ml-2 text-xs explanation-toggle" data-target="exp-multiplier">Explain</button>
              </label>
              <div id="exp-multiplier" class="explanation-box">
                Multiplies ARR by a factor (e.g., 5-8), ideal for steady recurring revenue.
                <br /><em>Example: If ARR is $1,000,000 and multiplier is 6, valuation = $6,000,000.</em>
              </div>

              <label class="flex items-center">
                <input type="checkbox" id="method-income" value="income" class="form-checkbox h-5 w-5 text-teal-500" />
                <span class="ml-2">Income-Based</span>
                <button type="button" class="text-teal-500 underline ml-2 text-xs explanation-toggle" data-target="exp-income">Explain</button>
              </label>
              <div id="exp-income" class="explanation-box">
                Uses net profit multiplied by a factor (e.g., 4-7), suitable for profitable businesses.
                <br /><em>Example: If net profit is $200,000 and multiplier is 5, valuation = $1,000,000.</em>
              </div>

              <label class="flex items-center">
                <input type="checkbox" id="method-earnings" value="earnings" class="form-checkbox h-5 w-5 text-teal-500" />
                <span class="ml-2">Earnings-Based</span>
                <button type="button" class="text-teal-500 underline ml-2 text-xs explanation-toggle" data-target="exp-earnings">Explain</button>
              </label>
              <div id="exp-earnings" class="explanation-box">
                Combines ARR and net profit with growth factors, ideal for scaling businesses.
                <br /><em>Example: $1,000,000 ARR + $200,000 profit with growth factors may yield $1,500,000.</em>
              </div>

              <label class="flex items-center">
                <input type="checkbox" id="method-dcf" value="dcf" class="form-checkbox h-5 w-5 text-teal-500" />
                <span class="ml-2">Discounted Cash Flow (DCF)</span>
                <button type="button" class="text-teal-500 underline ml-2 text-xs explanation-toggle" data-target="exp-dcf">Explain</button>
              </label>
              <div id="exp-dcf" class="explanation-box">
                Projects future cash flows discounted to present value, best for long-term projections.
                <br /><em>Example: $1,000,000 ARR with 20% growth over 5 years may yield $3,000,000.</em>
              </div>
            </div>

            <p id="method-error" class="text-red-500 text-sm mt-2 hidden">
              Please select between 1 and 3 valuation methods.
            </p>

            <div class="mt-6 flex justify-end">
              <button id="next-btn-1" class="btn-primary">Next</button>
            </div>
          </div>

          <!-- Step 2: Financial Metrics -->
          <div id="step-2" class="step step-hidden" data-step="2">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 2: Financial Metrics</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Provide key financial figures that reflect your business.
              <span data-tooltip="Use your latest financial statements." class="text-teal-500 underline cursor-pointer">Learn more</span>
            </p>
            <div class="space-y-4">
              <div>
                <label for="arr" class="block font-medium text-gray-700 mb-1">Annual Recurring Revenue (ARR) ($)</label>
                <input type="number" id="arr" min="0" step="1000" placeholder="e.g., 500000" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Total subscription revenue over last 12 months.<br /><em>Example: $1,200,000 from annual subscriptions.</em></p>
              </div>
              <div>
                <label for="mrr" class="block font-medium text-gray-700 mb-1">Monthly Recurring Revenue (MRR) ($)</label>
                <input type="number" id="mrr" min="0" step="100" placeholder="e.g., 41667" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Average subscription revenue per month.<br /><em>Example: $100,000 monthly subscriptions.</em></p>
              </div>
              <div>
                <label for="ltv" class="block font-medium text-gray-700 mb-1">Customer Lifetime Value (LTV) ($)</label>
                <input type="number" id="ltv" min="0" step="100" placeholder="e.g., 2000" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Revenue from one customer before they leave.<br /><em>Example: $2,000 average customer revenue.</em></p>
              </div>
              <div>
                <label for="cac" class="block font-medium text-gray-700 mb-1">Customer Acquisition Cost (CAC) ($)</label>
                <input type="number" id="cac" min="0" step="10" placeholder="e.g., 500" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Cost to acquire a new customer.<br /><em>Example: $500 spent per customer acquired.</em></p>
              </div>
              <div>
                <label for="gross-margin" class="block font-medium text-gray-700 mb-1">Gross Margin (%)</label>
                <input type="number" id="gross-margin" min="0" max="100" step="0.1" placeholder="e.g., 75" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Revenue after direct costs.<br /><em>Example: 75% means $0.75 left per dollar.</em></p>
              </div>
              <div>
                <label for="net-profit" class="block font-medium text-gray-700 mb-1">Net Profit / EBITDA ($)</label>
                <input type="number" id="net-profit" min="0" step="1000" placeholder="e.g., 200000" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Earnings after all expenses.<br /><em>Example: $200,000 profit this year.</em></p>
              </div>
              <div>
                <label for="burn-rate" class="block font-medium text-gray-700 mb-1">Monthly Burn Rate ($)</label>
                <input type="number" id="burn-rate" min="0" step="1000" placeholder="e.g., 25000" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Cash loss per month.<br /><em>Example: $25,000 overspend monthly.</em></p>
              </div>
              <div>
                <label for="runway" class="block font-medium text-gray-700 mb-1">Runway (Months of Cash Left)</label>
                <input type="number" id="runway" min="0" step="1" placeholder="e.g., 12" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Months before cash runs out.<br /><em>Example: 12 months left.</em></p>
              </div>
            </div>
            <p id="financial-error" class="text-red-500 text-sm mt-4 hidden">Please fill out all required financial fields.</p>
            <div class="mt-6 flex justify-between">
              <button id="prev-btn-2" class="btn-secondary">Previous</button>
              <button id="next-btn-2" class="btn-primary">Next</button>
            </div>
          </div>

          <!-- Step 3: Growth & Churn Rates -->
          <div id="step-3" class="step step-hidden" data-step="3">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 3: Growth and Churn Rates</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Enter your revenue growth and customer churn metrics.
              <span data-tooltip="These metrics influence your valuation multipliers." class="text-teal-500 underline cursor-pointer">Learn more</span>
            </p>
            <div class="space-y-4">
              <div>
                <label for="revenue-growth-yoy" class="block font-medium text-gray-700 mb-1">Revenue Growth Rate (Year-over-Year %)</label>
                <input type="number" id="revenue-growth-yoy" min="0" max="100" step="0.1" placeholder="e.g., 20" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Percent increase in revenue year-over-year.</p>
              </div>
              <div>
                <label for="revenue-growth-mom" class="block font-medium text-gray-700 mb-1">Revenue Growth Rate (Month-over-Month %)</label>
                <input type="number" id="revenue-growth-mom" min="0" max="100" step="0.1" placeholder="e.g., 3" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Percent increase in revenue month-to-month.</p>
              </div>
              <div>
                <label for="customer-churn" class="block font-medium text-gray-700 mb-1">Customer Churn Rate (%)</label>
                <input type="number" id="customer-churn" min="0" max="100" step="0.1" placeholder="e.g., 5" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Percent of customers lost monthly.</p>
              </div>
              <div>
                <label for="revenue-churn" class="block font-medium text-gray-700 mb-1">Revenue Churn Rate (%)</label>
                <input type="number" id="revenue-churn" min="0" max="100" step="0.1" placeholder="e.g., 4" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Percent of revenue lost due to churn.</p>
              </div>
            </div>
            <p id="growth-churn-error" class="text-red-500 text-sm mt-4 hidden">Please enter valid growth and churn percentages.</p>
            <div class="mt-6 flex justify-between">
              <button id="prev-btn-3" class="btn-secondary">Previous</button>
              <button id="next-btn-3" class="btn-primary">Next</button>
            </div>
          </div>

          <!-- Step 4: Customer & Market Metrics -->
          <div id="step-4" class="step step-hidden" data-step="4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 4: Customer & Market Metrics</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Tell us about your customers and market to refine your valuation.
              <span data-tooltip="These details adjust valuation risk and potential." class="text-teal-500 underline cursor-pointer">Learn more</span>
            </p>
            <div class="space-y-4">
              <div>
                <label for="active-customers" class="block font-medium text-gray-700 mb-1">Active Customers</label>
                <input type="number" id="active-customers" min="0" step="1" placeholder="e.g., 1500" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Number of paying customers.</p>
              </div>
              <div>
                <label for="monthly-active-users" class="block font-medium text-gray-700 mb-1">Monthly Active Users (MAU)</label>
                <input type="number" id="monthly-active-users" min="0" step="1" placeholder="e.g., 2000" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Users active each month.</p>
              </div>
              <div>
                <label for="retention-rate" class="block font-medium text-gray-700 mb-1">Retention Rate (%)</label>
                <input type="number" id="retention-rate" min="0" max="100" step="0.1" placeholder="e.g., 85" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Percent of customers retained.</p>
              </div>
              <div>
                <label for="nps" class="block font-medium text-gray-700 mb-1">Net Promoter Score (NPS)</label>
                <input type="number" id="nps" min="-100" max="100" step="1" placeholder="e.g., 70" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Likelihood of customer recommendations.</p>
              </div>
              <div>
                <label for="customer-segment" class="block font-medium text-gray-700 mb-1">Customer Segment</label>
                <select id="customer-segment" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select one</option>
                  <option value="small-business">Small Businesses</option>
                  <option value="mid-market">Mid-Market</option>
                  <option value="enterprise">Enterprise</option>
                  <option value="consumer">Consumer</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Primary customer type.</p>
              </div>
              <div>
                <label for="buyer-type" class="block font-medium text-gray-700 mb-1">Buyer Type / Exit Potential</label>
                <select id="buyer-type" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select one</option>
                  <option value="investors">Investors</option>
                  <option value="competitors">Competitors</option>
                  <option value="strategic-partners">Strategic Partners</option>
                  <option value="unknown">Unknown</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Potential acquirers or investors.</p>
              </div>
            </div>
            <p id="customer-market-error" class="text-red-500 text-sm mt-4 hidden">Please fill in all required fields correctly.</p>
            <div class="mt-6 flex justify-between">
              <button id="prev-btn-4" class="btn-secondary">Previous</button>
              <button id="next-btn-4" class="btn-primary">Next</button>
            </div>
          </div>

          <!-- Step 5: Product & Technology -->
          <div id="step-5" class="step step-hidden" data-step="5">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 5: Product & Technology</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Provide information about your product’s uniqueness and technology maturity.
              <span data-tooltip="Key technology metrics influence valuation." class="text-teal-500 underline cursor-pointer">Learn more</span>
            </p>
            <div class="space-y-4">
              <div>
                <label for="product-market-fit" class="block font-medium text-gray-700 mb-1">Product-Market Fit</label>
                <select id="product-market-fit" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select an option</option>
                  <option value="none">None</option>
                  <option value="early">Early Signs</option>
                  <option value="strong">Strong Fit</option>
                  <option value="fully-confirmed">Fully Confirmed</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">How well your product meets market needs.</p>
              </div>
              <div>
                <label for="proprietary-tech" class="block font-medium text-gray-700 mb-1">Proprietary Technology / IP</label>
                <select id="proprietary-tech" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select an option</option>
                  <option value="none">No</option>
                  <option value="patents">Patents Held</option>
                  <option value="copyrights">Copyrights / Trade Secrets</option>
                  <option value="both">Both</option>
                </selectbury id="code-quality" class="block font-medium text-gray-700 mb-1">Code Quality Reviewed</label>
                <select id="code-quality" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select an option</option>
                  <option value="no-review">No Review</option>
                  <option value="internal-review">Internal Review</option>
                  <option value="external-review">External Audit</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Professional assessment of code quality.</p>
              </div>
              <div>
                <label for="scalable-infrastructure" class="block font-medium text-gray-700 mb-1">Scalable Infrastructure</label>
                <select id="scalable-infrastructure" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select an option</option>
                  <option value="no">No</option>
                  <option value="partial">Partial</option>
                  <option value="yes">Yes</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Ability to handle rapid growth.</p>
              </div>
              <div>
                <label for="feature-release-frequency" class="block font-medium text-gray-700 mb-1">Feature Release Frequency</label>
                <select id="feature-release-frequency" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select frequency</option>
                  <option value="rarely">Rarely</option>
                  <option value="monthly">Monthly</option>
                  <option value="weekly">Weekly</option>
                  <option value="daily">Daily</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Frequency of new features or updates.</p>
              </div>
              <div>
                <label for="security-compliance" class="block font-medium text-gray-700 mb-1">Security Compliance</label>
                <select id="security-compliance" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select status</option>
                  <option value="none">None</option>
                  <option value="gdpr">GDPR</option>
                  <option value="iso27001">ISO 27001</option>
                  <option value="other">Other</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Data practice compliance status.</p>
              </div>
            </div>
            <p id="product-tech-error" class="text-red-500 text-sm mt-2 hidden">Please complete all product and technology fields.</p>
            <div class="mt-6 flex justify-between">
              <button id="prev-btn-5" class="btn-secondary">Previous</button>
              <button id="next-btn-5" class="btn-primary">Next</button>
            </div>
          </div>

          <!-- Step 6: Team & Operations -->
          <div id="step-6" class="step step-hidden" data-step="6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 6: Team & Operations</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Share details about your team and operational efficiency.
              <span data-tooltip="Strong teams increase valuation." class="text-teal-500 underline cursor-pointer">Learn more</span>
            </p>
            <div class="space-y-4">
              <div>
                <label for="fte" class="block font-medium text-gray-700 mb-1">Full-Time Employees</label>
                <input type="number" id="fte" min="0" step="1" placeholder="e.g., 25" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Number of full-time staff.</p>
              </div>
              <div>
                <label for="key-staff" class="block font-medium text-gray-700 mb-1">Founders / Key Staff</label>
                <input type="number" id="key-staff" min="0" step="1" placeholder="e.g., 3" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Number of key executives or founders.</p>
              </div>
              <div>
                <label for="turnover-rate" class="block font-medium text-gray-700 mb-1">Staff Turnover Rate (%)</label>
                <input type="number" id="turnover-rate" min="0" max="100" step="0.1" placeholder="e.g., 5" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Annual percentage of staff leaving.</p>
              </div>
              <div>
                <label for="eng-sales-ratio" class="block font-medium text-gray-700 mb-1">Engineering to Sales Ratio</label>
                <input type="number" id="eng-sales-ratio" min="0" step="0.01" placeholder="e.g., 2.5" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Ratio of engineers to salespeople.</p>
              </div>
              <div>
                <label for="support-tickets" class="block font-medium text-gray-700 mb-1">Support Tickets per Month</label>
                <input type="number" id="support-tickets" min="0" step="1" placeholder="e.g., 100" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Monthly customer support requests.</p>
              </div>
              <div>
                <label for="support-rating" class="block font-medium text-gray-700 mb-1">Customer Support Rating (1-10)</label>
                <input type="number" id="support-rating" min="1" max="10" step="1" placeholder="e.g., 8" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Support satisfaction rating.</p>
              </div>
              <div>
                <label for="headcount-growth" class="block font-medium text-gray-700 mb-1">Headcount Growth Rate (%)</label>
                <input type="number" id="headcount-growth" min="-100" max="100" step="0.1" placeholder="e.g., 20" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Annual change in employee count.</p>
              </div>
            </div>
            <p id="team-ops-error" class="text-red-500 text-sm mt-2 hidden">Please fill in all team and operations fields correctly.</p>
            <div class="mt-6 flex justify-between">
              <button id="prev-btn-6" class="btn-secondary">Previous</button>
              <button id="next-btn-6" class="btn-primary">Next</button>
            </div>
          </div>

          <!-- Step 7: Legal, Contracts & Risk -->
          <div id="step-7" class="step step-hidden" data-step="7">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 7: Legal, Contracts & Risk</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Provide information about your legal standing and risks.
              <span data-tooltip="Proper legal structures reduce risks." class="text-teal-500 underline cursor-pointer">Learn more</span>
            </p>
            <div class="space-y-4">
              <div>
                <label for="legal-entity" class="block font-medium text-gray-700 mb-1">Legal Entity Registered</label>
                <select id="legal-entity" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select an option</option>
                  <option value="yes">Yes</option>
                  <option value="no">No</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Is your business registered?</p>
              </div>
              <div>
                <label for="ip-ownership" class="block font-medium text-gray-700 mb-1">IP Ownership Verified</label>
                <select id="ip-ownership" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select an option</option>
                  <option value="yes">Fully Owned</option>
                  <option value="no">No or Partial Ownership</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Do you own all IP rights?</p>
              </div>
              <div>
                <label for="data-privacy" class="block Subjects id="data-privacy" class="block font-medium text-gray-700 mb-1">Data Privacy Compliance</label>
                <select id="data-privacy" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Select compliance level</option>
                  <option value="none">None</option>
                  <option value="partial">Partial</option>
                  <option value="full">Fully Compliant (GDPR, CCPA, etc.)</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Compliance with data privacy laws.</p>
              </div>
              <div>
                <label for="contract-renewal" class="block font-medium text-gray-700 mb-1">Contract Renewal Rate (%)</label>
                <input type="number" id="contract-renewal" min="0" max="100" step="0.1" placeholder="e.g., 85" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required />
                <p class="text-gray-500 text-xs mt-1">Percent of contracts renewed.</p>
              </div>
              <div>
                <label for="legal-issues" class="block font-medium text-gray-700 mb-1">Pending Legal Issues</label>
                <select id="legal-issues" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Are there pending legal issues?</option>
                  <option value="none">No</option>
                  <option value="minor">Minor / Resolved</option>
                  <option value="major">Major / Ongoing</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Any lawsuits or legal risks?</p>
              </div>
              <div>
                <label for="contract-templates" class="block font-medium text-gray-700 mb-1">Contract Templates Available</label>
                <select id="contract-templates" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Availability of templates</option>
                  <option value="yes">Yes, standardized</option>
                  <option value="no">No</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Use of standard contracts.</p>
              </div>
              <div>
                <label for="user-data-ownership" class="block font-medium text-gray-700 mb-1">Ownership of User Data</label>
                <select id="user-data-ownership" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Who owns the user data?</option>
                  <option value="company">Company</option>
                  <option value="customer">Customer</option>
                  <option value="shared">Shared</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Legal ownership of user data.</p>
              </div>
              <div>
                <label for="terms-update" class="block font-medium text-gray-700 mb-1">Updated Terms of Use</label>
                <select id="terms-update" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Are terms up to date?</option>
                  <option value="yes">Yes, recently updated</option>
                  <option value="no">No / outdated</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Current user policies.</p>
              </div>
              <div>
                <label for="legal-liabilities" class="block font-medium text-gray-700 mb-1">Legal Liabilities</label>
                <select id="legal-liabilities" class="w-full p-2 border rounded focus:ring focus:ring-teal-400" required>
                  <option value="" disabled selected>Any legal liabilities?</option>
                  <option value="none">None</option>
                  <option value="low">Low</option>
                  <option value="high">High</option>
                </select>
                <p class="text-gray-500 text-xs mt-1">Legal or financial risks.</p>
              </div>
            </div>
            <p id="legal-error" class="text-red-500 text-sm mt-2 hidden">Please complete all required legal fields.</p>
            <div class="mt-6 flex justify-between">
              <button id="prev-btn-7" class="btn-secondary">Previous</button>
              <button id="next-btn-7" class="btn-primary">Next</button>
            </div>
          </div>

          <!-- Step 8: Voucher Code & Payment -->
          <div id="step-8" class="step step-hidden" data-step="8">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Step 8: Voucher Code or Payment</h3>
            <p class="text-gray-600 mb-4 text-sm">
              Enter a voucher code for free valuation or continue with payment.
            </p>
            <input type="text" id="voucher-code-input" class="w-full p-2 border rounded-lg focus:ring focus:ring-teal-400 mb-2" placeholder="Enter voucher code" />
            <p id="voucher-error" class="text-red-500 text-sm mb-4 hidden">Invalid voucher code. Please try again or continue with payment.</p>
            <div class="flex space-x-4 mb-6">
              <button id="submit-voucher-btn" class="btn-primary flex-grow">Use Voucher Code</button>
              <button id="clear-voucher-btn" class="btn-secondary flex-grow">Clear</button>
            </div>
            <hr class="my-6" />
            <p class="text-center text-gray-700 mb-4">Or continue with secure payment:</p>
            <div id="paypal-container-NVJVZYW6GRKY4" class="mx-auto max-w-xs"></div>
            <div id="loading-spinner" class="hidden text-center mt-4">
              <i class="fas fa-spinner fa-spin text-teal-500"></i> Calculating...
            </div>
            <div id="payment-status" class="text-green-600 font-bold mt-4 mb-6 hidden">
              Payment successful! Calculating your valuation...
              <button id="retry-results" class="btn-primary mt-2">Retry Results</button>
            </div>
            <div class="mt-6 flex justify-between">
              <button id="prev-btn-8" class="btn-secondary">Previous</button>
            </div>
          </div>

          <!-- Valuation Results -->
          <div id="results-container" class="step-hidden bg-white p-6 rounded shadow max-w-3xl mx-auto">
            <h4 class="text-xl font-semibold text-teal-600 mb-4">Your Valuation Results</h4>
            <p id="valuation-result" class="text-lg font-bold mb-3">Calculating...</p>
            <div id="method-breakdown" class="text-gray-700 mb-3 text-sm"></div>
            <p id="advice" class="text-gray-700 text-sm"></p>
            <button id="download-pdf" class="btn-primary mt-6">Download Report (PDF)</button>
            <div class="mt-6">
              <h5 class="text-lg font-semibold text-gray-800 mb-2">Valuation by Method</h5>
              <canvas id="valuationChart" class="w-full max-w-full h-64"></canvas>
            </div>
            <div class="mt-6">
              <h5 class="text-lg font-semibold text-gray-800 mb-2">Projected Revenue Growth</h5>
              <canvas id="revenueGrowthChart" class="w-full max-w-full h-64"></canvas>
            </div>
          </div>
        </div>
      </section>
      <section></section>
      <center>
        <!-- Why Valuation Matters Info Box -->
        <section class="py-16 bg-gray-50 [data-theme='dark']:bg-gray-800 transition-colors duration-300">
          <div class="container mx-auto px-6">
            <div class="relative bg-white rounded-2xl shadow-xl max-w-4xl mx-auto p-8 [data-theme='dark']:bg-gray-700 animate-[fadeInUp_1s_ease-out] parallax-card">
              <div class="absolute inset-0 bg-gradient-to-r from-[var(--primary)]/10 to-transparent rounded-2xl"></div>
              <h2 class="text-3xl font-bold text-gray-800 mb-6 relative z-10 [data-theme='dark']:text-gray-100">Why Valuation Matters</h2>
              <p class="text-lg text-gray-600 mb-6 relative z-10 [data-theme='dark']:text-gray-300">Getting the right valuation is like knowing the true worth of your house before selling it—it helps you make smart decisions and get the best deal. Here’s why it’s so important:</p>
              <ul class="list-disc list-inside text-gray-600 mb-6 relative z-10 space-y-2 [data-theme='dark']:text-gray-300">
                <li><strong>Maximize Your Sale Price:</strong> A precise valuation shows buyers your business’s true value, helping you negotiate a higher price when selling.</li>
                <li><strong>Attract Investors:</strong> A clear, data-backed valuation makes your business more appealing to investors, showing them exactly what they’re getting.</li>
                <li><strong>Plan Strategically:</strong> Understanding your worth helps you decide whether to grow, sell, or raise funds, giving you a roadmap for success.</li>
                <li><strong>Avoid Undervaluing:</strong> Without a proper valuation, you might sell your business for less than it’s worth, missing out on thousands or millions.</li>
              </ul>
              <p class="text-lg text-gray-600 mb-8 relative z-10 [data-theme='dark']:text-gray-300">Whether you’re preparing to sell, seeking investment, or just planning ahead, Amanda Valuation Pro gives you the insights to make confident, informed decisions.</p>
              <div class="relative z-10">
                <a href="blog.html" class="btn-primary text-black font-bold py-3 px-8 rounded-lg shadow-md inline-flex items-center">
                  Learn More <i class="fas fa-arrow-right ml-2"></i>
                </a>
              </div>
            </div>
          </div>
          <style>
            .parallax-card {
              position: relative;
              transform: translateZ(0);
              transition: transform 0.3s ease;
            }
            .parallax-card:hover {
              transform: translateY(-5px);
            }
          </style>
        </section>
        <img src="https://theultimatemusicapp.github.io/AmandaValuation/web.jpg" alt="SaaSappinfo" />
      </center>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
          <div>
            <h4 class="text-lg font-semibold mb-3">Company</h4>
            <p class="text-gray-400 text-sm">SaaS Valuation App provides AI-driven insights to evaluate your business worth.</p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-3">Product</h4>
            <ul class="space-y-2">
              <li><a href="index.html#valuation">Self Valuation</a></li>
              <li><a href="index.html#data-room">AI Data Room</a></li>
              <li><a href="index.html#pricing">Pricing</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-3">Resources</h4>
            <ul class="space-y-2">
              <li><a href="blog.html">Blog</a></li>
              <li><a href="index.html#faq">FAQ</a></li>
              <li><a href="Support.html">Support</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-3">Legal</h4>
            <ul class="space-y-2">
              <li><a href="terms-and-conditions.html" class="text-gray-400 hover:text-teal-400 text-sm">Terms</a></li>
              <li><a href="privacy-policy.html" class="text-gray-400 hover:text-teal-400 text-sm">Privacy</a></li>
            </ul>
          </div>
        </div>
        <div class="text-center mt-4 text-gray-400 text-sm">
          <p>© 2025 SaaS Valuation App. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=BAAmPIUOhFD8WnPzN-tp-rQwqJ-5hrys3ik4nE0y2X41APCpAHOeX3swr5esUvo6CBAZzZH5iY8lcuBQB4&components=hosted-buttons&disable-funding=venmo&currency=AUD"></script>
  <script>
  <script>
  // Constants
  const VOUCHER_CODE = 'Password86$';
  const TOTAL_STEPS = 8;

  // Chart instances
  let valuationChart;
  let revenueGrowthChart;

  // Utility functions
  const val = id => {
    const el = document.getElementById(id);
    if (!el) return 0;
    const v = el.value.replace(/,/g, '').trim();
    const n = parseFloat(v);
    return isNaN(n) ? 0 : n;
  };

  const sval = id => {
    const el = document.getElementById(id);
    return el ? el.value.trim() : '';
  };

  // Step navigation
  let currentStep = 0;
  const steps = document.querySelectorAll('.step');

  function showStep(index) {
    console.log('Showing step:', index + 1);
    steps.forEach((step, i) => {
      step.classList.toggle('step-hidden', i !== index);
      step.classList.toggle('step-visible', i === index);
    });
    document.getElementById('current-step').textContent = index + 1;
    document.getElementById('progress-fill').style.width = ((index + 1) / TOTAL_STEPS) * 100 + '%';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // Validation functions
  function validateStep(stepIndex) {
    console.log('Validating step:', stepIndex + 1);
    let errorElement, inputs;
    try {
      switch (stepIndex) {
        case 0: // Valuation methods
          const checked = document.querySelectorAll('#step-1 input[type="checkbox"]:checked').length;
          errorElement = document.getElementById('method-error');
          if (!errorElement) throw new Error('Method error element not found');
          if (checked < 1 || checked > 3) {
            errorElement.classList.remove('hidden');
            console.log('Validation failed: Invalid number of methods selected:', checked);
            return false;
          }
          errorElement.classList.add('hidden');
          return true;

        case 1: // Financial metrics
          inputs = document.querySelectorAll('#step-2 input[required]');
          errorElement = document.getElementById('financial-error');
          if (!errorElement) throw new Error('Financial error element not found');
          for (let input of inputs) {
            if (!input.value || val(input.id) < 0) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Invalid financial input:', input.id);
              return false;
            }
          }
          errorElement.classList.add('hidden');
          return true;

        case 2: // Growth and churn
          inputs = document.querySelectorAll('#step-3 input[required]');
          errorElement = document.getElementById('growth-churn-error');
          if (!errorElement) throw new Error('Growth-churn error element not found');
          for (let input of inputs) {
            const value = val(input.id);
            if (!input.value || value < 0 || value > 100) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Invalid growth/churn input:', input.id, value);
              return false;
            }
          }
          errorElement.classList.add('hidden');
          return true;

        case 3: // Customer and market
          inputs = document.querySelectorAll('#step-4 input[required], #step-4 select[required]');
          errorElement = document.getElementById('customer-market-error');
          if (!errorElement) throw new Error('Customer-market error element not found');
          for (let input of inputs) {
            if (!input.value) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Missing customer/market input:', input.id);
              return false;
            }
            if (input.type === 'number') {
              const value = val(input.id);
              if (input.id === 'nps' && (value < -100 || value > 100)) {
                errorElement.classList.remove('hidden');
                console.log('Validation failed: Invalid NPS:', value);
                return false;
              }
              if (input.id !== 'nps' && value < 0) {
                errorElement.classList.remove('hidden');
                console.log('Validation failed: Negative value for:', input.id);
                return false;
              }
            }
          }
          errorElement.classList.add('hidden');
          return true;

        case 4: // Product and technology
          inputs = document.querySelectorAll('#step-5 select[required]');
          errorElement = document.getElementById('product-tech-error');
          if (!errorElement) throw new Error('Product-tech error element not found');
          for (let input of inputs) {
            if (!input.value) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Missing product/tech input:', input.id);
              return false;
            }
          }
          errorElement.classList.add('hidden');
          return true;

        case 5: // Team and operations
          inputs = document.querySelectorAll('#step-6 input[required]');
          errorElement = document.getElementById('team-ops-error');
          if (!errorElement) throw new Error('Team-ops error element not found');
          for (let input of inputs) {
            if (!input.value || val(input.id) < 0) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Invalid team/ops input:', input.id);
              return false;
            }
            if (input.id === 'support-rating' && (val(input.id) < 1 || val(input.id) > 10)) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Invalid support rating:', val(input.id));
              return false;
            }
          }
          errorElement.classList.add('hidden');
          return true;

        case 6: // Legal and contracts
          inputs = document.querySelectorAll('#step-7 input[required], #step-7 select[required]');
          errorElement = document.getElementById('legal-error');
          if (!errorElement) throw new Error('Legal error element not found');
          for (let input of inputs) {
            if (!input.value) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Missing legal input:', input.id);
              return false;
            }
            if (input.id === 'contract-renewal' && (val(input.id) < 0 || val(input.id) > 100)) {
              errorElement.classList.remove('hidden');
              console.log('Validation failed: Invalid contract renewal:', val(input.id));
              return false;
            }
          }
          errorElement.classList.add('hidden');
          return true;

        default:
          console.log('No validation required for step:', stepIndex + 1);
          return true;
      }
    } catch (error) {
      console.error('Error in validateStep:', error);
      return false;
    }
  }

  // Validate all steps before calculation
  function validateAllSteps() {
    console.log('Validating all steps...');
    for (let i = 0; i < TOTAL_STEPS - 1; i++) {
      if (!validateStep(i)) {
        console.error(`Validation failed for step ${i + 1}`);
        return false;
      }
    }
    console.log('All steps validated successfully.');
    return true;
  }

  // Calculate valuation
  function calculateValuation() {
    console.log('Starting valuation calculation...');
    showLoading();
    try {
      const methods = Array.from(document.querySelectorAll('#step-1 input[type=checkbox]:checked')).map(cb => cb.value);
      console.log('Selected valuation methods:', methods);
      if (methods.length === 0) {
        throw new Error('No valuation methods selected.');
      }

      // Gather inputs with fallback values
      const arr = val('arr') || 0;
      const mrr = val('mrr') || 0;
      const ltv = val('ltv') || 0;
      const cac = val('cac') || 0;
      const grossMargin = (val('gross-margin') / 100) || 0;
      const netProfit = val('net-profit') || 0;
      const burnRate = val('burn-rate') || 0;
      const runway = val('runway') || 0;
      const revenueGrowth = (val('revenue-growth-yoy') / 100) || 0;
      const churnRate = (val('customer-churn') / 100) || 0;
      const retentionRate = (val('retention-rate') / 100) || 0;
      const pmFit = sval('product-market-fit') || 'none';
      const legalRisks = sval('legal-liabilities') || 'none';

      // Check critical inputs
      if (arr <= 0 && mrr <= 0 && netProfit <= 0) {
        throw new Error('At least one of ARR, MRR, or Net Profit must be greater than zero.');
      }

      // Base multipliers
      const baseRevenueMultiplier = 6;
      const baseIncomeMultiplier = 5;

      let valuations = {};
      let totalValuation = 0;

      // Revenue Multiplier
      if (methods.includes('multiplier')) {
        let multiplier = baseRevenueMultiplier + revenueGrowth * 3 - churnRate * 2 + grossMargin / 50;
        multiplier = Math.min(Math.max(multiplier, 3), 10);
        const valRevenue = arr * multiplier;
        valuations['Revenue Multiplier'] = valRevenue || 0;
        totalValuation += valRevenue || 0;
      }

      // Income-Based
      if (methods.includes('income')) {
        let multiplier = baseIncomeMultiplier + revenueGrowth * 3 - churnRate * 2;
        multiplier = Math.min(Math.max(multiplier, 3), 8);
        const valIncome = netProfit * multiplier;
        valuations['Income-Based'] = valIncome || 0;
        totalValuation += valIncome || 0;
      }

      // Earnings-Based
      if (methods.includes('earnings')) {
        let pmFitFactor = pmFit === 'none' ? 0.8 : pmFit === 'early' ? 1.0 : pmFit === 'strong' ? 1.2 : 1.4;
        let retentionFactor = retentionRate || 1;
        let teamFactor = 1 + (val('fte') / 50);
        const valEarnings = (arr + netProfit) * pmFitFactor * retentionFactor * teamFactor;
        valuations['Earnings-Based'] = valEarnings || 0;
        totalValuation += valEarnings || 0;
      }

      // DCF
      if (methods.includes('dcf')) {
        const discountRate = 0.12 + churnRate / 200 + (legalRisks === 'high' ? 0.05 : 0);
        let cashFlow = arr || mrr * 12 || netProfit || 1000;
        let dcfValue = 0;
        let growthAdjustment = revenueGrowth + (pmFit === 'fully-confirmed' ? 0.05 : 0);
        for (let year = 1; year <= 5; year++) {
          cashFlow *= 1 + growthAdjustment;
          dcfValue += cashFlow / Math.pow(1 + discountRate, year);
        }
        valuations['Discounted Cash Flow'] = dcfValue || 0;
        totalValuation += dcfValue || 0;
      }

      // Average valuation
      const avgValuation = methods.length > 0 ? totalValuation / methods.length : 0;

      // Build breakdown
      let breakdownHTML = '<ul class="list-disc pl-5">';
      for (const [key, val] of Object.entries(valuations)) {
        breakdownHTML += `<li><strong>${key}:</strong> $${Math.round(val).toLocaleString()}</li>`;
      }
      breakdownHTML += '</ul>';

      // Advice
      let advice = '';
      if (churnRate > 0.1) advice += 'High customer churn detected; focus on retention.<br>';
      if (arr > 0 && netProfit / arr < 0.1) advice += 'Low profit margins; consider cost optimization.<br>';
      if (legalRisks === 'high') advice += 'Address legal liabilities to improve valuation.<br>';
      if (!advice) advice = 'Your inputs look strong. Well done!';

      // Store results in localStorage
      const resultsData = {
        valuation: `<strong>Estimated Valuation: $${Math.round(avgValuation).toLocaleString()}</strong>`,
        breakdown: breakdownHTML,
        advice: advice,
        chartData: {
          labels: Object.keys(valuations),
          data: Object.values(valuations).map(v => Math.round(v))
        },
        inputs: {
          arr, mrr, ltv, cac, grossMargin: grossMargin * 100, netProfit, burnRate, runway,
          revenueGrowth: revenueGrowth * 100, churnRate: churnRate * 100, retentionRate: retentionRate * 100,
          pmFit, legalRisks, fte: val('fte'), nps: val('nps'), supportRating: val('support-rating'),
          contractRenewal: val('contract-renewal')
        },
        timestamp: Date.now()
      };
      localStorage.setItem('saasValuationResults', JSON.stringify(resultsData));

      // Update DOM
      document.getElementById('valuation-result').innerHTML = resultsData.valuation;
      document.getElementById('method-breakdown').innerHTML = resultsData.breakdown;
      document.getElementById('advice').innerHTML = resultsData.advice;

      // Stored chart data
      window.valuationChartData = resultsData.chartData;

      renderCharts();
      console.log('Valuation calculated and stored successfully.');
    } catch (error) {
      console.error('Error in calculateValuation:', error.message, error.stack);
      throw error;
    } finally {
      hideLoading();
    }
  }

  // Render charts
  function renderCharts() {
    try {
      const ctxVal = document.getElementById('valuationChart').getContext('2d');
      const ctxRev = document.getElementById('revenueGrowthChart').getContext('2d');

      if (valuationChart) valuationChart.destroy();
      if (revenueGrowthChart) revenueGrowthChart.destroy();

      const valuationData = window.valuationChartData || { labels: [], data: [] };

      valuationChart = new Chart(ctxVal, {
        type: 'bar',
        data: {
          labels: valuationData.labels,
          datasets: [{
            label: 'Valuation ($)',
            data: valuationData.data,
            backgroundColor: 'rgba(56, 178, 172, 0.7)',
            borderColor: 'rgba(56, 178, 172, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: { y: { beginAtZero: true, title: { display: true, text: 'Valuation ($)' } } },
          plugins: { legend: { display: false }, title: { display: true, text: 'Valuation Comparison' } }
        }
      });

      const arr = val('arr') || 1000;
      const growthRate = (val('revenue-growth-yoy') / 100) || 0;
      const labels = ['Current Year', 'Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'];
      const revenueData = [arr];
      for (let i = 1; i <= 5; i++) {
        revenueData.push(revenueData[i - 1] * (1 + growthRate));
      }

      revenueGrowthChart = new Chart(ctxRev, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Projected Revenue ($)',
            data: revenueData.map(v => Math.round(v)),
            fill: false,
            borderColor: 'rgba(56, 178, 172, 1)',
            tension: 0.1
          }]
        },
        options: {
          scales: { y: { beginAtZero: true, title: { display: true, text: 'Revenue ($)' } } },
          plugins: { legend: { display: false }, title: { display: true, text: 'Projected 5-Year Revenue Growth' } }
        }
      });
    } catch (error) {
      console.error('Error rendering charts:', error);
      document.getElementById('valuation-result').innerHTML += '<br><small>Charts could not be rendered, but valuation results are still valid.</small>';
    }
  }

  // Loading spinner
  function showLoading() {
    document.getElementById('loading-spinner').classList.remove('hidden');
  }

  function hideLoading() {
    document.getElementById('loading-spinner').classList.add('hidden');
  }

  // PDF export
  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });

    // Colors
    const teal = '#38B2AC';
    const darkGray = '#2D3748';

    // Helper function to add text with wrapping
    const addWrappedText = (text, x, y, maxWidth, fontSize, color, fontStyle = 'normal') => {
      doc.setFontSize(fontSize);
      doc.setTextColor(color);
      doc.setFont('helvetica', fontStyle);
      doc.text(text, x, y, { maxWidth });
    };

    // Cover Page
    doc.setFillColor(teal);
    doc.rect(0, 0, 210, 40, 'F');
    addWrappedText('SaaS Valuation App', 10, 20, 190, 24, '#FFFFFF', 'bold');
    addWrappedText('Pro Valuation Report', 10, 30, 190, 18, '#FFFFFF', 'bold');
    addWrappedText('Comprehensive Business Evaluation', 10, 60, 190, 14, darkGray);
    addWrappedText('Prepared on ' + new Date().toLocaleDateString(), 10, 80, 190, 12, darkGray);
    addWrappedText('Powered by AI-Driven Insights | https://saasvaluation.app', 10, 100, 190, 10, darkGray);
    addWrappedText('Confidential – For Internal Use Only', 10, 120, 190, 8, darkGray);
    doc.addPage();

    // Header and Footer on all pages
    const addHeaderFooter = () => {
      doc.setFillColor(teal);
      doc.rect(0, 0, 210, 10, 'F');
      addWrappedText('SaaS Valuation App', 10, 7, 100, 8, '#FFFFFF');
      addWrappedText('Page ' + doc.internal.getCurrentPageInfo().pageNumber, 190, 7, 20, 8, '#FFFFFF', 'bold');
      doc.setFillColor(darkGray);
      doc.rect(0, 287, 210, 10, 'F');
      addWrappedText('© 2025 SaaS Valuation App', 10, 294, 190, 8, '#FFFFFF');
    };

    // Executive Summary
    addHeaderFooter();
    addWrappedText('Executive Summary', 10, 20, 190, 16, teal, 'bold');
    addWrappedText(
      'This SaaS Pro Valuation Report provides a comprehensive evaluation of your business, leveraging advanced metrics and AI-driven insights. Below are the key findings:',
      10, 30, 190, 10, darkGray
    );
    const valuation = document.getElementById('valuation-result').textContent;
    const methods = Array.from(document.querySelectorAll('#step-1 input[type=checkbox]:checked'))
      .map(cb => cb.value.replace('multiplier', 'Revenue Multiplier').replace('income', 'Income-Based').replace('earnings', 'Earnings-Based').replace('dcf', 'Discounted Cash Flow'))
      .join(', ');
    const advice = document.getElementById('advice').textContent;
    addWrappedText(`• Estimated Valuation: ${valuation}`, 10, 40, 190, 10, darkGray);
    addWrappedText(`• Valuation Methods: ${methods}`, 10, 48, 190, 10, darkGray);
    addWrappedText(`• Key Strengths: High revenue growth, strong product-market fit, or scalable infrastructure.`, 10, 56, 190, 10, darkGray);
    addWrappedText(`• Areas for Improvement: ${advice}`, 10, 64, 190, 10, darkGray);

    // Valuation Breakdown
    addWrappedText('Valuation Breakdown', 10, 80, 190, 16, teal, 'bold');
    addWrappedText('The valuation is calculated using the following methods:', 10, 90, 190, 10, darkGray);
    let yPos = 100;
    document.querySelectorAll('#method-breakdown li').forEach(li => {
      const [method, amount] = li.textContent.split(': ');
      const description = method === 'Revenue Multiplier' ? 'Based on ARR multiplied by a factor adjusted for growth and churn.' :
                        method === 'Income-Based' ? 'Derived from net profit with multipliers reflecting profitability.' :
                        method === 'Earnings-Based' ? 'Combines ARR and net profit, adjusted for retention.' :
                        'Projects future cash flows discounted to present value.';
      addWrappedText(`• ${method}: ${amount}`, 10, yPos, 190, 10, darkGray);
      addWrappedText(description, 15, yPos + 5, 185, 8, darkGray);
      yPos += 15;
    });

    // Add Valuation Chart
    const valuationCanvas = document.getElementById('valuationChart');
    if (valuationCanvas) {
      const valuationImage = valuationCanvas.toDataURL('image/png');
      doc.addImage(valuationImage, 'PNG', 10, yPos, 190, 60);
      yPos += 70;
    }

    doc.addPage();

    // Key Financial Metrics
    addHeaderFooter();
    addWrappedText('Key Financial Metrics', 10, 20, 190, 16, teal, 'bold');
    addWrappedText('Critical financial inputs driving the valuation:', 10, 30, 190, 10, darkGray);
    const metrics = [
      { label: 'Annual Recurring Revenue (ARR)', value: `$${val('arr').toLocaleString()}` },
      { label: 'Monthly Recurring Revenue (MRR)', value: `$${val('mrr').toLocaleString()}` },
      { label: 'Customer Lifetime Value (LTV)', value: `$${val('ltv').toLocaleString()}` },
      { label: 'Customer Acquisition Cost (CAC)', value: `$${val('cac').toLocaleString()}` },
      { label: 'Gross Margin', value: `${val('gross-margin')}%` },
      { label: 'Net Profit / EBITDA', value: `$${val('net-profit').toLocaleString()}` },
      { label: 'Monthly Burn Rate', value: `$${val('burn-rate').toLocaleString()}` },
      { label: 'Runway', value: `${val('runway')} months` },
      { label: 'Revenue Growth (YoY)', value: `${val('revenue-growth-yoy')}%` },
      { label: 'Customer Churn Rate', value: `${val('customer-churn')}%` }
    ];
    yPos = 40;
    metrics.forEach(metric => {
      addWrappedText(`${metric.label}: ${metric.value}`, 10, yPos, 190, 10, darkGray);
      yPos += 8;
    });

    // Add Revenue Growth Chart
    const revenueCanvas = document.getElementById('revenueGrowthChart');
    if (revenueCanvas) {
      const revenueImage = revenueCanvas.toDataURL('image/png');
      doc.addImage(revenueImage, 'PNG', 10, yPos, 190, 60);
      yPos += 70;
    }

    doc.addPage();

    // Strategic Recommendations
    addHeaderFooter();
    addWrappedText('Strategic Recommendations', 10, 20, 190, 16, teal, 'bold');
    addWrappedText('To enhance your business value:', 10, 30, 190, 10, darkGray);
    const churnRate = val('customer-churn');
    const netProfit = val('net-profit');
    const arr = val('arr');
    const legalRisks = sval('legal-liabilities');
    const recommendations = [
      churnRate > 10 ? `• Reduce Churn: High churn rates (${churnRate}%) suggest focusing on customer retention strategies.` : null,
      netProfit / arr < 0.1 && arr > 0 ? `• Optimize Profitability: Low profit margins indicate potential for cost optimization.` : null,
      legalRisks === 'high' ? `• Mitigate Legal Risks: Address legal liabilities to reduce valuation discounts.` : null,
      `• Leverage Strengths: Capitalize on strong product-market fit or scalable infrastructure.`
    ].filter(Boolean);
    yPos = 40;
    recommendations.forEach(rec => {
      addWrappedText(rec, 10, yPos, 190, 10, darkGray);
      yPos += 8;
    });

    // About Section
    addWrappedText('About SaaS Valuation App', 10, yPos + 10, 190, 16, teal, 'bold');
    addWrappedText(
      'SaaS Valuation App provides AI-driven insights to help business owners understand their company’s worth. Visit https://saasvaluation.app for more information.',
      10, yPos + 20, 190, 10, darkGray
    );

    // Save the PDF
    doc.save('saas-pro-valuation-report.pdf');
  }

  // Clear localStorage on new valuation start
  document.addEventListener('DOMContentLoaded', () => {
    localStorage.removeItem('saasValuationResults');
    showStep(0);

    // Retry results
    document.getElementById('retry-results').addEventListener('click', () => {
      console.log('Retrying results display...');
      try {
        if (validateAllSteps()) {
          calculateValuation();
          const results = document.getElementById('results-container');
          if (results) {
            results.classList.remove('step-hidden');
            results.classList.add('step-visible');
            results.scrollIntoView({ behavior: 'smooth' });
            document.getElementById('payment-status').textContent = 'Valuation recalculated successfully.';
          } else {
            console.error('Results container not found.');
            document.getElementById('payment-status').textContent = 'Error: Results container not found. Please contact support.';
          }
        } else {
          document.getElementById('payment-status').textContent = 'Error: Invalid inputs. Please go back and complete all steps.';
        }
      } catch (error) {
        console.error('Error retrying results:', error);
        document.getElementById('payment-status').textContent = `Error: ${error.message}. Please try again or contact support.`;
      }
    });

    // Download PDF
    document.getElementById('download-pdf').addEventListener('click', downloadPDF);

    // Step navigation
    for (let i = 1; i <= TOTAL_STEPS; i++) {
      const nextBtn = document.getElementById(`next-btn-${i}`);
      const prevBtn = document.getElementById(`prev-btn-${i}`);
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          console.log(`Next button clicked for step ${i}`);
          if (validateStep(i - 1)) {
            currentStep = Math.min(currentStep + 1, TOTAL_STEPS - 1);
            showStep(currentStep);
          } else {
            console.log(`Validation failed for step ${i}`);
          }
        });
      } else {
        console.warn(`Next button not found for step ${i}`);
      }
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          console.log(`Previous button clicked for step ${i}`);
          currentStep = Math.max(currentStep - 1, 0);
          showStep(currentStep);
        });
      }
    }

    // Explanation toggles
    document.querySelectorAll('.explanation-toggle').forEach(button => {
      button.addEventListener('click', () => {
        console.log('Explanation toggle clicked:', button.getAttribute('data-target'));
        const targetId = button.getAttribute('data-target');
        const explanation = document.getElementById(targetId);
        explanation.classList.toggle('expanded');
      });
    });

    // Voucher code handling
    document.getElementById('submit-voucher-btn').addEventListener('click', () => {
      console.log('Voucher submit clicked');
      const voucherInput = document.getElementById('voucher-code-input');
      const voucherError = document.getElementById('voucher-error');
      if (voucherInput.value === VOUCHER_CODE) {
        voucherError.classList.add('hidden');
        if (validateAllSteps()) {
          calculateValuation();
          const results = document.getElementById('results-container');
          results.classList.remove('step-hidden');
          results.classList.add('step-visible');
          results.scrollIntoView({ behavior: 'smooth' });
          document.getElementById('payment-status').textContent = 'Voucher accepted! Valuation calculated.';
        } else {
          voucherError.textContent = 'Invalid or missing input data. Please complete all steps.';
          voucherError.classList.remove('hidden');
        }
      } else {
        voucherError.textContent = 'Invalid voucher code. Please check your email for the correct code or continue with payment.';
        voucherError.classList.remove('hidden');
      }
    });

    document.getElementById('clear-voucher-btn').addEventListener('click', () => {
      console.log('Voucher clear clicked');
      document.getElementById('voucher-code-input').value = '';
      document.getElementById('voucher-error').classList.add('hidden');
    });

    // Mobile menu toggle
    document.getElementById('menu-toggle').addEventListener('click', () => {
      console.log('Mobile menu toggled');
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('hidden');
      const icon = document.getElementById('menu-toggle').querySelector('i');
      icon.classList.toggle('fa-bars');
      icon.classList.toggle('fa-times');
    });
  });

  // PayPal integration
  paypal.HostedButtons({
    hostedButtonId: "NVJVZYW6GRKY4",
    onApprove: function(data, actions) {
      console.log('PayPal payment approved:', data);
      const paymentStatus = document.getElementById('payment-status');
      const paypalContainer = document.getElementById('paypal-container-NVJVZYW6GRKY4');
      const results = document.getElementById('results-container');

      // Check for missing DOM elements
      if (!paymentStatus || !paypalContainer || !results) {
        console.error('Missing DOM elements:', { paymentStatus, paypalContainer, results });
        document.getElementById('voucher-error').textContent = 'Error: Missing required page elements. Please contact support.';
        document.getElementById('voucher-error').classList.remove('hidden');
        return;
      }

      try {
        // Update UI to indicate processing
        paymentStatus.textContent = 'Processing payment...';
        paymentStatus.classList.remove('hidden');
        paypalContainer.style.display = 'none';

        // Validate inputs before calculating
        if (!validateAllSteps()) {
          throw new Error('Invalid or missing input data. Please go back and complete all steps.');
        }

        // Calculate valuation and store in localStorage
        console.log('Calling calculateValuation...');
        calculateValuation();

        // Show results temporarily (before redirect)
        console.log('Showing results container...');
        results.classList.remove('step-hidden');
        results.classList.add('step-visible');
        results.scrollIntoView({ behavior: 'smooth' });

        // Update status
        paymentStatus.innerHTML = `Payment successful! Redirecting to results page...<br>Your voucher code is: ${VOUCHER_CODE}<br>Use this code to access results again or share with your team. Check your email for the transaction confirmation.`;

        // Allow PayPal to handle redirect via Auto Return
      } catch (error) {
        console.error('Error in onApprove:', error.message, error.stack);
        paymentStatus.textContent = `Error: ${error.message}. Please try again or contact support.`;
        paymentStatus.classList.remove('hidden');
        document.getElementById('retry-results').classList.remove('hidden');
      }
    },
    onError: function(error) {
      console.error('PayPal error:', error);
      document.getElementById('voucher-error').textContent = 'Payment failed. Please try again or contact support.';
      document.getElementById('voucher-error').classList.remove('hidden');
    }
  }).render("#paypal-container-NVJVZYW6GRKY4");
</script>
</body>
</html>
     
