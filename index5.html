<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amanda Valuation | Business Valuation in 15 Minutes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- React and Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
    <!-- Chart.js and jsPDF -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #2D3748 0%, #38B2AC 100%);
        }
        .nav-link:hover {
            color: #38B2AC;
        }
        .btn-primary {
            background-color: #38B2AC;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2D3748;
            transform: translateY(-2px);
        }
        .btn-secondary {
            border: 2px solid #38B2AC;
            color: #38B2AC;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #38B2AC;
            color: white;
        }
        .feature-card:hover, .testimonial-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background-color: #E2E8F0;
        }
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            background-color: #38B2AC;
            transition: width 0.5s ease;
        }
        .tooltip {
            position: relative;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #2D3748;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .input-highlight {
            transition: all 0.3s ease;
        }
        .input-highlight:focus {
            box-shadow: 0 0 0 3px rgba(56, 178, 172, 0.3);
            border-color: #38B2AC;
        }
        .step {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .step-hidden {
            opacity: 0;
            transform: translateX(20px);
            display: none;
        }
        .step-visible {
            opacity: 1;
            transform: translateX(0);
            display: block;
        }
        .chart-container {
            height: 300px;
            width: 100%;
        }
        .error-message {
            color: #EF4444;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body class="bg-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Navigation Component
        const Navigation = () => {
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

            return (
                <header className="bg-white shadow-md py-4 sticky top-0 z-50">
                    <nav className="container mx-auto px-6 flex justify-between items-center">
                        <div className="flex items-center">
                            <span className="text-2xl font-bold text-gray-800">
                                Amanda<span className="text-teal-500">Valuation</span>
                            </span>
                        </div>
                        <div className="hidden md:flex space-x-8">
                            <a href="#valuation" className="nav-link text-gray-600 hover:text-teal-500 font-medium">Self Valuation</a>
                            <a href="#tech-due-diligence" className="nav-link text-gray-600 hover:text-teal-500 font-medium">Tech Due Diligence</a>
                            <a href="#data-room" className="nav-link text-gray-600 hover:text-teal-500 font-medium">AI Data Room</a>
                            <a href="#pricing" className="nav-link text-gray-600 hover:text-teal-500 font-medium">Pricing</a>
                            <a href="#resources" className="nav-link text-gray-600 hover:text-teal-500 font-medium">Resources</a>
                        </div>
                        <div className="md:hidden">
                            <button
                                onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                                className="text-gray-600 focus:outline-none"
                                aria-label="Toggle mobile menu"
                            >
                                <i className="fas fa-bars text-xl"></i>
                            </button>
                        </div>
                    </nav>
                    <div className={`${isMobileMenuOpen ? 'block' : 'hidden'} md:hidden bg-white px-6 pt-2 pb-4`}>
                        <a href="#valuation" className="block py-2 text-gray-600 hover:text-teal-500">Self Valuation</a>
                        <a href="#tech-due-diligence" className="block py-2 text-gray-600 hover:text-teal-500">Tech Due Diligence</a>
                        <a href="#data-room" className="block py-2 text-gray-600 hover:text-teal-500">AI Data Room</a>
                        <a href="#pricing" className="block py-2 text-gray-600 hover:text-teal-500">Pricing</a>
                        <a href="#resources" className="block py-2 text-gray-600 hover:text-teal-500">Resources</a>
                    </div>
                </header>
            );
        };

        // Hero Component
        const Hero = ({ openDemoModal }) => (
            <section className="gradient-bg text-white py-20">
                <div className="container mx-auto px-6 flex flex-col md:flex-row items-center">
                    <div className="md:w-1/2 mb-10 md:mb-0">
                        <h1 className="text-4xl md:text-5xl font-bold mb-4">What's Your Business Worth?</h1>
                        <h2 className="text-2xl md:text-3xl font-semibold mb-6">Find Out in 15 Minutes</h2>
                        <p className="text-lg mb-8 opacity-90">
                            Get a fast, accurate business valuation and actionable insights with Amanda Valuation's free self-assessment tools.
                        </p>
                        <div className="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                            <a href="#valuation" className="btn-primary text-white font-bold py-3 px-8 rounded-lg text-center">Get Started Now</a>
                            <button
                                onClick={openDemoModal}
                                className="btn-secondary font-bold py-3 px-8 rounded-lg text-center flex items-center justify-center"
                            >
                                <i className="fas fa-play-circle mr-2"></i> Watch Demo
                            </button>
                        </div>
                    </div>
                    <div className="md:w-1/2 relative">
                        <div className="relative">
                            <div className="absolute inset-0 bg-teal-500 rounded-xl opacity-20 blur-lg"></div>
                            <div className="relative bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-xl p-6 border border-white border-opacity-20">
                                <div className="flex justify-between items-center mb-4">
                                    <div className="flex items-center">
                                        <div className="w-3 h-3 rounded-full bg-red-500 mr-2"></div>
                                        <div className="w-3 h-3 rounded-full bg-yellow-500 mr-2"></div>
                                        <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                    </div>
                                    <span className="text-sm font-medium">Valuation Dashboard</span>
                                </div>
                                <div className="bg-white bg-opacity-5 rounded-lg p-4 mb-4">
                                    <div className="flex justify-between mb-2">
                                        <span className="text-sm">Estimated Value Range</span>
                                        <span className="text-sm font-bold">$1.2M - $1.8M</span>
                                    </div>
                                    <div className="w-full bg-gray-700 rounded-full h-2.5">
                                        <div className="bg-teal-400 h-2.5 rounded-full" style={{ width: '70%' }}></div>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div className="bg-white bg-opacity-5 rounded-lg p-4">
                                        <p className="text-xs opacity-70 mb-1">Revenue Growth</p>
                                        <p className="text-lg font-bold">32%</p>
                                        <div className="flex items-center mt-1">
                                            <i className="fas fa-arrow-up text-green-400 mr-1 text-xs"></i>
                                            <span className="text-xs">+8% from last year</span>
                                        </div>
                                    </div>
                                    <div className="bg-white bg-opacity-5 rounded-lg p-4">
                                        <p className="text-xs opacity-70 mb-1">Profit Margin</p>
                                        <p className="text-lg font-bold">18%</p>
                                        <div className="flex items-center mt-1">
                                            <i className="fas fa-arrow-up text-green-400 mr-1 text-xs"></i>
                                            <span className="text-xs">+3% from last year</span>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-teal-500 bg-opacity-20 rounded-lg p-3 text-center">
                                    <p className="text-sm font-medium">Your Business is in the <span className="font-bold">Top 30%</span> of SaaS Companies</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        );

        // Demo Modal Component
        const DemoModal = ({ isOpen, closeModal }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg w-full max-w-4xl mx-4 relative">
                        <button
                            onClick={closeModal}
                            className="absolute -top-10 right-0 text-white text-3xl"
                            aria-label="Close modal"
                        >
                            Ã—
                        </button>
                        <div className="aspect-w-16 aspect-h-9">
                            <iframe
                                className="w-full h-96 rounded-t-lg"
                                src="https://www.youtube.com/embed/dQw4w9WgXcQ?rel=0"
                                frameBorder="0"
                                allowFullScreen
                                title="Demo Video"
                            ></iframe>
                        </div>
                        <div className="p-6">
                            <h3 className="text-2xl font-bold mb-2">See Amanda Valuation in Action</h3>
                            <p className="text-gray-600 mb-4">
                                Watch how easy it is to get your business valuation in just 15 minutes with our step-by-step process.
                            </p>
                            <a href="#valuation" className="btn-primary text-white font-bold py-2 px-6 rounded-lg inline-block">
                                Start Your Valuation Now
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        // Valuation Form Component
        const ValuationForm = () => {
            const [step, setStep] = useState(1);
            const [formData, setFormData] = useState({
                valuationMethods: [],
                ownerSalary: '',
                averageSalary: '',
                employeeBenefits: '',
                staffNumber: '',
                expenses: '',
                debt: '',
                scalability: 5,
                growthRate: '',
                yearsOperating: '',
                ltv: '',
                cac: '',
                churnRate: '',
                customerGrowthRate: '',
                industry: '',
                marketTrendImpact: 5,
                competitivePositioning: 5,
                marketVolatility: 5,
                aiReplaceable: '',
                aiReplaceCount: '',
                hasIP: '',
                ipValue: '',
                ipUnique: '',
                operationalEfficiency: 5,
                projectedRevenue: '',
                expectedGrowthRate: '',
                cashFlow1: '',
                cashFlow2: '',
                cashFlow3: '',
                cashFlow4: '',
                cashFlow5: '',
                discountRate: '',
                terminalGrowthRate: '',
                assets: ''
            });
            const [errors, setErrors] = useState({});
            const [results, setResults] = useState(null);
            const valuationChartRef = useRef(null);
            const staffChartRef = useRef(null);
            const incomeChartRef = useRef(null);
            const dcfChartRef = useRef(null);

            const totalSteps = 6;

            const validateStep = (currentStep) => {
                const newErrors = {};
                if (currentStep === 1) {
                    if (formData.valuationMethods.length === 0 || formData.valuationMethods.length > 3) {
                        newErrors.valuationMethods = 'Please select 1 to 3 valuation methods.';
                    }
                } else if (currentStep === 2) {
                    if (!formData.ownerSalary || isNaN(parseFloat(formData.ownerSalary.replace(/,/g, ''))))
                        newErrors.ownerSalary = 'Please enter a valid owner salary.';
                    if (!formData.averageSalary || isNaN(parseFloat(formData.averageSalary.replace(/,/g, ''))))
                        newErrors.averageSalary = 'Please enter a valid average staff salary.';
                    if (!formData.staffNumber || isNaN(parseInt(formData.staffNumber)))
                        newErrors.staffNumber = 'Please enter a valid number of staff.';
                    if (!formData.expenses || isNaN(parseFloat(formData.expenses.replace(/,/g, ''))))
                        newErrors.expenses = 'Please enter valid operating expenses.';
                    if (!formData.debt || isNaN(parseFloat(formData.debt.replace(/,/g, ''))))
                        newErrors.debt = 'Please enter a valid total debt.';
                    if (!formData.growthRate || isNaN(parseFloat(formData.growthRate)))
                        newErrors.growthRate = 'Please enter a valid growth rate.';
                    if (!formData.yearsOperating || isNaN(parseInt(formData.yearsOperating)))
                        newErrors.yearsOperating = 'Please enter valid years operating.';
                } else if (currentStep === 3) {
                    if (!formData.ltv || isNaN(parseFloat(formData.ltv.replace(/,/g, ''))))
                        newErrors.ltv = 'Please enter a valid LTV.';
                    if (!formData.cac || isNaN(parseFloat(formData.cac.replace(/,/g, ''))))
                        newErrors.cac = 'Please enter a valid CAC.';
                    if (!formData.churnRate || isNaN(parseFloat(formData.churnRate)))
                        newErrors.churnRate = 'Please enter a valid churn rate.';
                    if (!formData.customerGrowthRate || isNaN(parseFloat(formData.customerGrowthRate)))
                        newErrors.customerGrowthRate = 'Please enter a valid customer growth rate.';
                } else if (currentStep === 4) {
                    if (!formData.industry) newErrors.industry = 'Please select an industry.';
                } else if (currentStep === 5) {
                    if (!formData.aiReplaceable) newErrors.aiReplaceable = 'Please select an option.';
                    if (formData.aiReplaceable === 'yes' && (!formData.aiReplaceCount || isNaN(parseInt(formData.aiReplaceCount))))
                        newErrors.aiReplaceCount = 'Please enter a valid number.';
                    if (!formData.hasIP) newErrors.hasIP = 'Please select an option.';
                    if (formData.hasIP === 'yes') {
                        if (!formData.ipValue || isNaN(parseFloat(formData.ipValue.replace(/,/g, ''))))
                            newErrors.ipValue = 'Please enter a valid IP value.';
                        if (!formData.ipUnique) newErrors.ipUnique = 'Please select an option.';
                    }
                } else if (currentStep === 6) {
                    if (!formData.projectedRevenue || isNaN(parseFloat(formData.projectedRevenue.replace(/,/g, ''))))
                        newErrors.projectedRevenue = 'Please enter a valid projected revenue.';
                    if (!formData.expectedGrowthRate || isNaN(parseFloat(formData.expectedGrowthRate)))
                        newErrors.expectedGrowthRate = 'Please enter a valid growth rate.';
                    if (formData.valuationMethods.includes('dcf')) {
                        ['cashFlow1', 'cashFlow2', 'cashFlow3', 'cashFlow4', 'cashFlow5'].forEach((field, i) => {
                            if (!formData[field] || isNaN(parseFloat(formData[field].replace(/,/g, ''))))
                                newErrors[field] = `Please enter a valid cash flow for Year ${i + 1}.`;
                        });
                        if (!formData.discountRate || isNaN(parseFloat(formData.discountRate)))
                            newErrors.discountRate = 'Please enter a valid discount rate.';
                        if (!formData.terminalGrowthRate || isNaN(parseFloat(formData.terminalGrowthRate)))
                            newErrors.terminalGrowthRate = 'Please enter a valid terminal growth rate.';
                    }
                    if (formData.valuationMethods.includes('earnings')) {
                        if (!formData.assets || isNaN(parseFloat(formData.assets.replace(/,/g, ''))))
                            newErrors.assets = 'Please enter a valid total assets value.';
                    }
                }
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleInputChange = (e) => {
                const { name, value, type, checked } = e.target;
                if (type === 'checkbox') {
                    setFormData(prev => ({
                        ...prev,
                        valuationMethods: checked
                            ? [...prev.valuationMethods, value]
                            : prev.valuationMethods.filter(m => m !== value)
                    }));
                } else {
                    setFormData(prev => ({ ...prev, [name]: value }));
                }
            };

            const handleNext = () => {
                if (validateStep(step) && step < totalSteps) {
                    setStep(step + 1);
                }
            };

            const handlePrevious = () => {
                if (step > 1) setStep(step - 1);
            };

            const handleStartOver = () => {
                setStep(1);
                setFormData({
                    valuationMethods: [],
                    ownerSalary: '',
                    averageSalary: '',
                    employeeBenefits: '',
                    staffNumber: '',
                    expenses: '',
                    debt: '',
                    scalability: 5,
                    growthRate: '',
                    yearsOperating: '',
                    ltv: '',
                    cac: '',
                    churnRate: '',
                    customerGrowthRate: '',
                    industry: '',
                    marketTrendImpact: 5,
                    competitivePositioning: 5,
                    marketVolatility: 5,
                    aiReplaceable: '',
                    aiReplaceCount: '',
                    hasIP: '',
                    ipValue: '',
                    ipUnique: '',
                    operationalEfficiency: 5,
                    projectedRevenue: '',
                    expectedGrowthRate: '',
                    cashFlow1: '',
                    cashFlow2: '',
                    cashFlow3: '',
                    cashFlow4: '',
                    cashFlow5: '',
                    discountRate: '',
                    terminalGrowthRate: '',
                    assets: ''
                });
                setErrors({});
                setResults(null);
            };

            const calculateValuation = () => {
                if (!validateStep(step)) return;

                const {
                    valuationMethods, ownerSalary, averageSalary, employeeBenefits, staffNumber, expenses, debt,
                    scalability, growthRate, yearsOperating, ltv, cac, churnRate, customerGrowthRate,
                    industry, marketTrendImpact, competitivePositioning, marketVolatility,
                    aiReplaceable, aiReplaceCount, hasIP, ipValue, ipUnique, operationalEfficiency,
                    projectedRevenue, expectedGrowthRate, cashFlow1, cashFlow2, cashFlow3, cashFlow4, cashFlow5,
                    discountRate, terminalGrowthRate, assets
                } = formData;

                const parsedData = {
                    ownerSalary: parseFloat(ownerSalary.replace(/,/g, '')) || 0,
                    averageSalary: parseFloat(averageSalary.replace(/,/g, '')) || 0,
                    employeeBenefits: parseFloat(employeeBenefits.replace(/,/g, '')) || 0,
                    staffNumber: parseInt(staffNumber) || 0,
                    expenses: parseFloat(expenses.replace(/,/g, '')) || 0,
                    debt: parseFloat(debt.replace(/,/g, '')) || 0,
                    scalability: parseInt(scalability) || 5,
                    growthRate: parseFloat(growthRate) || 0,
                    yearsOperating: parseInt(yearsOperating) || 0,
                    ltv: parseFloat(ltv.replace(/,/g, '')) || 0,
                    cac: parseFloat(cac.replace(/,/g, '')) || 0,
                    churnRate: parseFloat(churnRate) || 0,
                    customerGrowthRate: parseFloat(customerGrowthRate) || 0,
                    marketTrendImpact: parseInt(marketTrendImpact) || 5,
                    competitivePositioning: parseInt(competitivePositioning) || 5,
                    marketVolatility: parseInt(marketVolatility) || 5,
                    aiReplaceCount: aiReplaceable === 'yes' ? parseInt(aiReplaceCount) || 0 : 0,
                    ipValue: hasIP === 'yes' ? parseFloat(ipValue.replace(/,/g, '')) || 0 : 0,
                    operationalEfficiency: parseInt(operationalEfficiency) || 5,
                    projectedRevenue: parseFloat(projectedRevenue.replace(/,/g, '')) || 0,
                    expectedGrowthRate: parseFloat(expectedGrowthRate) || 0,
                    cashFlows: [
                        parseFloat(cashFlow1.replace(/,/g, '')) || 0,
                        parseFloat(cashFlow2.replace(/,/g, '')) || 0,
                        parseFloat(cashFlow3.replace(/,/g, '')) || 0,
                        parseFloat(cashFlow4.replace(/,/g, '')) || 0,
                        parseFloat(cashFlow5.replace(/,/g, '')) || 0
                    ],
                    discountRate: parseFloat(discountRate) / 100 || 0.1,
                    terminalGrowthRate: parseFloat(terminalGrowthRate) / 100 || 0.03,
                    assets: parseFloat(assets.replace(/,/g, '')) || 0
                };

                let valuations = [];
                let valuationDetails = [];

                // Multiplier Method
                if (valuationMethods.includes('multiplier')) {
                    const industryMultipliers = {
                        'Technology': 5, 'Retail': 2, 'Hospitality': 1.5, 'Media': 3, 'Marketing': 2.5,
                        'Construction': 1.2, 'Healthcare': 4, 'Finance': 3.5, 'Real Estate': 2, 'Education': 2.5,
                        'Transportation': 1.8, 'Agriculture': 1.5, 'Manufacturing': 2, 'Legal': 3, 'Energy': 2.5,
                        'Arts & Entertainment': 2, 'Other': 2
                    };
                    const multiplier = industryMultipliers[industry] || 2;
                    let baseValue = parsedData.projectedRevenue * multiplier;

                    baseValue *= (1 + (parsedData.growthRate / 100));
                    baseValue *= (1 + (parsedData.scalability - 5) * 0.05);
                    baseValue *= (1 + (parsedData.competitivePositioning - 5) * 0.03);
                    baseValue *= (1 - (parsedData.churnRate / 100) * 0.5);
                    baseValue -= parsedData.debt;

                    if (hasIP === 'yes') {
                        baseValue += parsedData.ipValue * (ipUnique === 'unique' ? 1.2 : 0.8);
                    }

                    const minValue = baseValue * 0.9;
                    const maxValue = baseValue * 1.1;

                    valuations.push({ method: 'Multiplier Method', min: minValue, max: maxValue, avg: baseValue });
                    valuationDetails.push(
                        `Multiplier Method: Used an industry multiplier of ${multiplier}x for ${industry}. ` +
                        `Adjusted for growth rate (${parsedData.growthRate}%), scalability (${parsedData.scalability}), ` +
                        `competitive positioning (${parsedData.competitivePositioning}), churn rate (${parsedData.churnRate}%), ` +
                        `and IP value ($${parsedData.ipValue.toLocaleString()}).`
                    );
                }

                // Income-Based Valuation
                if (valuationMethods.includes('income')) {
                    let baseValue = parsedData.projectedRevenue * 3;

                    baseValue *= (1 + (parsedData.expectedGrowthRate / 100));
                    baseValue *= (1 + (parsedData.marketTrendImpact - 5) * 0.04);
                    baseValue *= (1 - (parsedData.marketVolatility - 5) * 0.03);
                    baseValue -= parsedData.debt;

                    const ltvCacRatio = parsedData.ltv / (parsedData.cac || 1);
                    baseValue *= (ltvCacRatio > 3 ? 1.1 : ltvCacRatio < 1 ? 0.9 : 1);

                    const minValue = baseValue * 0.9;
                    const maxValue = baseValue * 1.1;

                    valuations.push({ method: 'Income-Based Valuation', min: minValue, max: maxValue, avg: baseValue });
                    valuationDetails.push(
                        `Income-Based Valuation: Based on projected revenue ($${parsedData.projectedRevenue.toLocaleString()}) with a 3x multiplier. ` +
                        `Adjusted for expected growth (${parsedData.expectedGrowthRate}%), market trends (${parsedData.marketTrendImpact}), ` +
                        `market volatility (${parsedData.marketVolatility}), and LTV/CAC ratio (${ltvCacRatio.toFixed(2)}).`
                    );
                }

                // Earnings-Based Valuation
                if (valuationMethods.includes('earnings')) {
                    const netEarnings = parsedData.projectedRevenue - parsedData.expenses -
                        (parsedData.averageSalary * parsedData.staffNumber) - parsedData.employeeBenefits - parsedData.ownerSalary;
                    let baseValue = (netEarnings * 4) + parsedData.assets;

                    baseValue *= (1 + (parsedData.operationalEfficiency - 5) * 0.05);
                    baseValue *= (1 + (parsedData.yearsOperating / 10));
                    baseValue -= parsedData.debt;

                    if (aiReplaceable === 'yes') {
                        const savings = parsedData.aiReplaceCount * parsedData.averageSalary * 0.5;
                        baseValue += savings;
                    }

                    const minValue = baseValue * 0.9;
                    const maxValue = baseValue * 1.1;

                    valuations.push({ method: 'Earnings-Based Valuation', min: minValue, max: maxValue, avg: baseValue });
                    valuationDetails.push(
                        `Earnings-Based Valuation: Calculated from net earnings ($${netEarnings.toLocaleString()}) with a 4x multiplier ` +
                        `plus assets ($${parsedData.assets.toLocaleString()}). Adjusted for operational efficiency (${parsedData.operationalEfficiency}), ` +
                        `years operating (${parsedData.yearsOperating}), and AI replaceability savings ($${((parsedData.aiReplaceCount * parsedData.averageSalary * 0.5) || 0).toLocaleString()}).`
                    );
                }

                // DCF Valuation
                if (valuationMethods.includes('dcf')) {
                    let dcfValue = 0;
                    for (let i = 0; i < parsedData.cashFlows.length; i++) {
                        dcfValue += parsedData.cashFlows[i] / Math.pow(1 + parsedData.discountRate, i + 1);
                    }

                    const terminalValue = (parsedData.cashFlows[4] * (1 + parsedData.terminalGrowthRate)) /
                        (parsedData.discountRate - parsedData.terminalGrowthRate);
                    dcfValue += terminalValue / Math.pow(1 + parsedData.discountRate, 5);
                    dcfValue -= parsedData.debt;

                    const minValue = dcfValue * 0.9;
                    const maxValue = dcfValue * 1.1;

                    valuations.push({ method: 'Discounted Cash Flow (DCF)', min: minValue, max: maxValue, avg: dcfValue });
                    valuationDetails.push(
                        `Discounted Cash Flow (DCF): Sum of discounted cash flows over 5 years (Year 1: $${parsedData.cashFlows[0].toLocaleString()}, ` +
                        `Year 5: $${parsedData.cashFlows[4].toLocaleString()}) with a discount rate of ${(parsedData.discountRate * 100).toFixed(2)}% ` +
                        `and terminal growth rate of ${(parsedData.terminalGrowthRate * 100).toFixed(2)}%. Terminal value: $${terminalValue.toLocaleString()}.`
                    );
                }

                const avgValuation = valuations.reduce((sum, v) => sum + v.avg, 0) / valuations.length;
                const minValuation = valuations.reduce((min, v) => Math.min(min, v.min), valuations[0].min);
                const maxValuation = valuations.reduce((max, v) => Math.max(max, v.max), valuations[0].max);

                setResults({
                    valuations,
                    valuationDetails,
                    avgValuation,
                    minValuation,
                    maxValuation,
                    financialMetrics: {
                        projectedRevenue: parsedData.projectedRevenue,
                        netEarnings: parsedData.projectedRevenue - parsedData.expenses -
                            (parsedData.averageSalary * parsedData.staffNumber) - parsedData.employeeBenefits - parsedData.ownerSalary,
                        ltvCacRatio: parsedData.ltv / (parsedData.cac || 1),
                        churnRate: parsedData.churnRate,
                        growthRate: parsedData.growthRate
                    }
                });
            };

            const exportResults = () => {
                if (!results) return;
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFontSize(20);
                doc.text('Business Valuation Report', 20, 20);
                doc.setFontSize(12);
                doc.text('Generated by Amanda Valuation', 20, 30);
                doc.setLineWidth(0.5);
                doc.line(20, 35, 190, 35);

                let y = 45;
                doc.setFontSize(16);
                doc.text('Valuation Summary', 20, y);
                y += 10;

                doc.setFontSize(12);
                doc.text(`Estimated Valuation: $${Math.round(results.avgValuation).toLocaleString()}`, 20, y);
                y += 10;

                doc.text('Valuation Ranges by Method:', 20, y);
                y += 10;
                results.valuations.forEach(v => {
                    doc.text(`${v.method}: $${Math.round(v.min).toLocaleString()} - $${Math.round(v.max).toLocaleString()}`, 25, y);
                    y += 7;
                });

                y += 5;
                doc.text('Key Financial Metrics:', 20, y);
                y += 10;
                const metrics = [
                    `Projected Revenue: $${results.financialMetrics.projectedRevenue.toLocaleString()}`,
                    `Net Earnings: $${results.financialMetrics.netEarnings.toLocaleString()}`,
                    `LTV/CAC Ratio: ${results.financialMetrics.ltvCacRatio.toFixed(2)}`,
                    `Churn Rate: ${results.financialMetrics.churnRate}%`,
                    `Growth Rate: ${results.financialMetrics.growthRate}%`
                ];
                metrics.forEach(metric => {
                    doc.text(metric, 25, y);
                    y += 7;
                });

                y += 5;
                doc.text('Valuation Factors:', 20, y);
                y += 10;
                results.valuationDetails.forEach(detail => {
                    const lines = doc.splitTextToSize(detail, 160);
                    lines.forEach(line => {
                        doc.text(line, 25, y);
                        y += 7;
                    });
                });

                doc.save('Amanda_Valuation_Report.pdf');
            };

            const saveProgress = () => {
                const blob = new Blob([JSON.stringify(formData)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'valuation_progress.json';
                a.click();
                URL.revokeObjectURL(url);
            };

            useEffect(() => {
                if (results) {
                    // Valuation Chart
                    if (valuationChartRef.current) {
                        valuationChartRef.current.destroy();
                    }
                    const valuationCanvas = document.getElementById('valuationChart');
                    valuationChartRef.current = new Chart(valuationCanvas, {
                        type: 'bar',
                        data: {
                            labels: results.valuations.map(v => v.method),
                            datasets: [{
                                label: 'Valuation Range',
                                data: results.valuations.map(v => v.avg),
                                backgroundColor: 'rgba(56, 178, 172, 0.6)',
                                borderColor: 'rgba(56, 178, 172, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: { y: { beginAtZero: true, title: { display: true, text: 'Valuation ($)' } } },
                            plugins: { legend: { display: false } }
                        }
                    });

                    // Staff Chart
                    if (staffChartRef.current) {
                        staffChartRef.current.destroy();
                    }
                    const staffCanvas = document.getElementById('staffChart');
                    staffChartRef.current = new Chart(staffCanvas, {
                        type: 'doughnut',
                        data: {
                            labels: ['Owner Salary', 'Staff Salaries', 'Benefits'],
                            datasets: [{
                                data: [
                                    formData.ownerSalary.replace(/,/g, '') || 0,
                                    (formData.averageSalary.replace(/,/g, '') || 0) * (formData.staffNumber || 0),
                                    formData.employeeBenefits.replace(/,/g, '') || 0
                                ],
                                backgroundColor: ['rgba(56, 178, 172, 0.6)', 'rgba(45, 55, 72, 0.6)', 'rgba(246, 173, 85, 0.6)'],
                                borderColor: ['rgba(56, 178, 172, 1)', 'rgba(45, 55, 72, 1)', 'rgba(246, 173, 85, 1)'],
                                borderWidth: 1
                            }]
                        },
                        options: { plugins: { legend: { position: 'bottom' } } }
                    });

                    // Income Chart
                    if (incomeChartRef.current) {
                        incomeChartRef.current.destroy();
                    }
                    const incomeCanvas = document.getElementById('incomeChart');
                    incomeChartRef.current = new Chart(incomeCanvas, {
                        type: 'line',
                        data: {
                            labels: ['Current Revenue', 'Projected Revenue'],
                            datasets: [{
                                label: 'Revenue',
                                data: [
                                    (formData.projectedRevenue.replace(/,/g, '') || 0) / (1 + ((formData.expectedGrowthRate || 0) / 100)),
                                    formData.projectedRevenue.replace(/,/g, '') || 0
                                ],
                                fill: false,
                                borderColor: 'rgba(56, 178, 172, 1)',
                                tension: 0.1
                            }]
                        },
                        options: {
                            scales: { y: { beginAtZero: true, title: { display: true, text: 'Revenue ($)' } } }
                        }
                    });

                    // DCF Chart
                    if (formData.valuationMethods.includes('dcf')) {
                        if (dcfChartRef.current) {
                            dcfChartRef.current.destroy();
                        }
                        const dcfCanvas = document.getElementById('dcfChart');
                        dcfChartRef.current = new Chart(dcfCanvas, {
                            type: 'line',
                            data: {
                                labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'],
                                datasets: [{
                                    label: 'Cash Flows',
                                    data: [
                                        formData.cashFlow1.replace(/,/g, '') || 0,
                                        formData.cashFlow2.replace(/,/g, '') || 0,
                                        formData.cashFlow3.replace(/,/g, '') || 0,
                                        formData.cashFlow4.replace(/,/g, '') || 0,
                                        formData.cashFlow5.replace(/,/g, '') || 0
                                    ],
                                    fill: false,
                                    borderColor: 'rgba(56, 178, 172, 1)',
                                    tension: 0.1
                                }]
                            },
                            options: {
                                scales: { y: { beginAtZero: true, title: { display: true, text: 'Cash Flow ($)' } } }
                            }
                        });
                    }
                }

                return () => {
                    if (valuationChartRef.current) valuationChartRef.current.destroy();
                    if (staffChartRef.current) staffChartRef.current.destroy();
                    if (incomeChartRef.current) incomeChartRef.current.destroy();
                    if (dcfChartRef.current) dcfChartRef.current.destroy();
                };
            }, [results]);

            const renderStep = () => {
                switch (step) {
                    case 1:
                        return (
                            <div className={`step ${step === 1 ? 'step-visible' : 'step-hidden'}`}>
                                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-calculator mr-2 text-teal-500"></i> Valuation Method Selection
                                </h2>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Select Valuation Methods (Choose up to 3):
                                    </label>
                                    <div className="space-y-2">
                                        {['multiplier', 'income', 'earnings', 'dcf'].map(method => (
                                            <div key={method} className="flex items-center">
                                                <input
                                                    type="checkbox"
                                                    id={`method-${method}`}
                                                    name="valuationMethods"
                                                    value={method}
                                                    checked={formData.valuationMethods.includes(method)}
                                                    onChange={handleInputChange}
                                                    className="mr-2 input-highlight"
                                                />
                                                <label htmlFor={`method-${method}`} className="text-sm text-gray-700">
                                                    {method === 'multiplier' && 'Multiplier Method - Based on industry multipliers.'}
                                                    {method === 'income' && 'Income-Based Valuation - Focuses on total revenue.'}
                                                    {method === 'earnings' && 'Earnings-Based Valuation - Focuses on net profit.'}
                                                    {method === 'dcf' && 'Discounted Cash Flow (DCF) - Based on future cash flows.'}
                                                </label>
                                            </div>
                                        ))}
                                    </div>
                                    {errors.valuationMethods && <p className="error-message">{errors.valuationMethods}</p>}
                                    <p className="mt-1 text-sm text-gray-500">Select methods to compare multiple valuation approaches.</p>
                                </div>
                                <div className="flex justify-end">
                                    <button
                                        onClick={handleNext}
                                        className="btn-primary text-white font-bold py-2 px-6 rounded-lg"
                                    >
                                        Next <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        );
                    case 2:
                        return (
                            <div className={`step ${step === 2 ? 'step-visible' : 'step-hidden'}`}>
                                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-list-alt mr-2 text-teal-500"></i> Business Fundamentals
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {[
                                        { id: 'ownerSalary', label: 'Owner Salary ($)', placeholder: '80,000.00', desc: 'Enter your annual salary as the owner.' },
                                        { id: 'averageSalary', label: 'Average Staff Salary ($)', placeholder: '50,000.00', desc: 'Average annual salary of your staff members.' },
                                        { id: 'employeeBenefits', label: 'Employee Benefits & Equity ($)', placeholder: '10,000.00', desc: 'Include costs like stock options or bonuses.' },
                                        { id: 'staffNumber', label: 'Number of Staff', placeholder: '10', type: 'number', desc: 'Total number of staff employed.' },
                                        { id: 'expenses', label: 'Annual Operating Expenses ($)', placeholder: '50,000.00', desc: 'Exclude salaries, benefits, and debt repayments.' },
                                        { id: 'debt', label: 'Total Debt ($)', placeholder: '20,000.00', desc: 'Total outstanding debts or liabilities.' },
                                        { id: 'growthRate', label: 'Growth Rate (%)', placeholder: '5.00', desc: 'Average annual revenue growth rate.', suffix: '%' },
                                        { id: 'yearsOperating', label: 'Years Operating', placeholder: '5', type: 'number', desc: 'Number of years your business has been operating.' }
                                    ].map(field => (
                                        <div key={field.id}>
                                            <label htmlFor={field.id} className="block text-sm font-medium text-gray-700 mb-1">{field.label}</label>
                                            <div className="relative rounded-md shadow-sm">
                                                {field.prefix && (
                                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                        <span className="text-gray-500 sm:text-sm">$</span>
                                                    </div>
                                                )}
                                                <input
                                                    type={field.type || 'text'}
                                                    id={field.id}
                                                    name={field.id}
                                                    value={formData[field.id]}
                                                    onChange={handleInputChange}
                                                    placeholder={field.placeholder}
                                                    className={`input-highlight block w-full ${field.prefix ? 'pl-7' : ''} ${field.suffix ? 'pr-12' : ''} sm:text-sm border-gray-300 rounded-md`}
                                                    aria-describedby={`${field.id}-desc`}
                                                />
                                                {field.suffix && (
                                                    <div className="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                        <span className="text-gray-500 sm:text-sm">{field.suffix}</span>
                                                    </div>
                                                )}
                                            </div>
                                            {errors[field.id] && <p className="error-message">{errors[field.id]}</p>}
                                            <p className="mt-1 text-sm text-gray-500" id={`${field.id}-desc`}>{field.desc}</p>
                                        </div>
                                    ))}
                                    <div>
                                        <label htmlFor="scalability" className="block text-sm font-medium text-gray-700 mb-1">Scalability (1-10)</label>
                                        <div className="flex items-center">
                                            <input
                                                type="range"
                                                id="scalability"
                                                name="scalability"
                                                min="1"
                                                max="10"
                                                value={formData.scalability}
                                                onChange={handleInputChange}
                                                className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                            />
                                            <span className="ml-3 text-sm font-medium text-gray-700">{formData.scalability}</span>
                                        </div>
                                        <p className="mt-1 text-sm text-gray-500">Rate how easily your business can scale (1 = Not scalable, 10 = Highly scalable).</p>
                                    </div>
                                </div>
                                <div className="flex justify-between mt-6">
                                    <button
                                        onClick={handlePrevious}
                                        className="btn-secondary font-bold py-2 px-6 rounded-lg"
                                    >
                                        <i className="fas fa-arrow-left mr-2"></i> Previous
                                    </button>
                                    <button
                                        onClick={handleNext}
                                        className="btn-primary text-white font-bold py-2 px-6 rounded-lg"
                                    >
                                        Next <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        );
                    case 3:
                        return (
                            <div className={`step ${step === 3 ? 'step-visible' : 'step-hidden'}`}>
                                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-users mr-2 text-teal-500"></i> Customer Metrics
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {[
                                        { id: 'ltv', label: 'Customer Lifetime Value (LTV) ($)', placeholder: '1,000.00', desc: 'Average revenue per customer over their lifetime.', prefix: '$' },
                                        { id: 'cac', label: 'Customer Acquisition Cost (CAC) ($)', placeholder: '200.00', desc: 'Average cost to acquire a new customer.', prefix: '$' },
                                        { id: 'churnRate', label: 'Churn Rate (%)', placeholder: '5.00', desc: 'Percentage of customers lost annually.', suffix: '%' },
                                        { id: 'customerGrowthRate', label: 'Customer Growth Rate (%)', placeholder: '10.00', desc: 'Annual growth rate of your customer base.', suffix: '%' }
                                    ].map(field => (
                                        <div key={field.id}>
                                            <label htmlFor={field.id} className="block text-sm font-medium text-gray-700 mb-1">{field.label}</label>
                                            <div className="relative rounded-md shadow-sm">
                                                {field.prefix && (
                                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                        <span className="text-gray-500 sm:text-sm">{field.prefix}</span>
                                                    </div>
                                                )}
                                                <input
                                                    type="text"
                                                    id={field.id}
                                                    name={field.id}
                                                    value={formData[field.id]}
                                                    onChange={handleInputChange}
                                                    placeholder={field.placeholder}
                                                    className={`input-highlight block w-full ${field.prefix ? 'pl-7' : ''} ${field.suffix ? 'pr-12' : ''} sm:text-sm border-gray-300 rounded-md`}
                                                    aria-describedby={`${field.id}-desc`}
                                                />
                                                {field.suffix && (
                                                    <div className="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                        <span className="text-gray-500 sm:text-sm">{field.suffix}</span>
                                                    </div>
                                                )}
                                            </div>
                                            {errors[field.id] && <p className="error-message">{errors[field.id]}</p>}
                                            <p className="mt-1 text-sm text-gray-500" id={`${field.id}-desc`}>{field.desc}</p>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex justify-between mt-6">
                                    <button
                                        onClick={handlePrevious}
                                        className="btn-secondary font-bold py-2 px-6 rounded-lg"
                                    >
                                        <i className="fas fa-arrow-left mr-2"></i> Previous
                                    </button>
                                    <button
                                        onClick={handleNext}
                                        className="btn-primary text-white font-bold py-2 px-6 rounded-lg"
                                    >
                                        Next <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        );
                    case 4:
                        return (
                            <div className={`step ${step === 4 ? 'step-visible' : 'step-hidden'}`}>
                                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-industry mr-2 text-teal-500"></i> Market and Industry Factors
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label htmlFor="industry" className="block text-sm font-medium text-gray-700 mb-1">Select Industry</label>
                                        <select
                                            id="industry"
                                            name="industry"
                                            value={formData.industry}
                                            onChange={handleInputChange}
                                            className="input-highlight block w-full pl-3 pr-10 py-2 text-base border-gray-300 rounded-md"
                                            aria-describedby="industry-desc"
                                        >
                                            <option value="">--Select Industry--</option>
                                            {[
                                                'Technology', 'Retail', 'Hospitality', 'Media', 'Marketing', 'Construction',
                                                'Healthcare', 'Finance', 'Real Estate', 'Education', 'Transportation', 'Agriculture',
                                                'Manufacturing', 'Legal', 'Energy', 'Arts & Entertainment', 'Other'
                                            ].map(ind => (
                                                <option key={ind} value={ind}>{ind}</option>
                                            ))}
                                        </select>
                                        {errors.industry && <p className="error-message">{errors.industry}</p>}
                                        <p className="mt-1 text-sm text-gray-500" id="industry-desc">Choose your industry for accurate valuation.</p>
                                    </div>
                                    {[
                                        { id: 'marketTrendImpact', label: 'Market Trend Impact (1-10)', desc: 'Rate the impact of market trends on your business (1 = Negative, 10 = Positive).' },
                                        { id: 'competitivePositioning', label: 'Competitive Positioning (1-10)', desc: 'Rate your market position against competitors (1 = Weak, 10 = Dominant).' },
                                        { id: 'marketVolatility', label: 'Market Volatility (1-10)', desc: 'Rate market stability (1 = Highly Volatile, 10 = Very Stable).' }
                                    ].map(field => (
                                        <div key={field.id}>
                                            <label htmlFor={field.id} className="block text-sm font-medium text-gray-700 mb-1">{field.label}</label>
                                            <div className="flex items-center">
                                                <input
                                                    type="range"
                                                    id={field.id}
                                                    name={field.id}
                                                    min="1"
                                                    max="10"
                                                    value={formData[field.id]}
                                                    onChange={handleInputChange}
                                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                                />
                                                <span className="ml-3 text-sm font-medium text-gray-700">{formData[field.id]}</span>
                                            </div>
                                            <p className="mt-1 text-sm text-gray-500">{field.desc}</p>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex justify-between mt-6">
                                    <button
                                        onClick={handlePrevious}
                                        className="btn-secondary font-bold py-2 px-6 rounded-lg"
                                    >
                                        <i className="fas fa-arrow-left mr-2"></i> Previous
                                    </button>
                                    <button
                                        onClick={handleNext}
                                        className="btn-primary text-white font-bold py-2 px-6 rounded-lg"
                                    >
                                        Next <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        );
                    case 5:
                        return (
                            <div className={`step ${step === 5 ? 'step-visible' : 'step-hidden'}`}>
                                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-cogs mr-2 text-teal-500"></i> Advanced Inputs
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label htmlFor="aiReplaceable" className="block text-sm font-medium text-gray-700 mb-1">Can Staff be Replaced by AI?</label>
                                        <select
                                            id="aiReplaceable"
                                            name="aiReplaceable"
                                            value={formData.aiReplaceable}
                                            onChange={handleInputChange}
                                            className="input-highlight block w-full pl-3 pr-10 py-2 text-base border-gray-300 rounded-md"
                                            aria-describedby="aiReplaceable-desc"
                                        >
                                            <option value="">--Select--</option>
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                        {errors.aiReplaceable && <p className="error-message">{errors.aiReplaceable}</p>}
                                        <p className="mt-1 text-sm text-gray-500" id="aiReplaceable-desc">Select 'Yes' if some roles can be automated.</p>
                                    </div>
                                    {formData.aiReplaceable === 'yes' && (
                                        <div>
                                            <label htmlFor="aiReplaceCount" className="block text-sm font-medium text-gray-700 mb-1">Number of Staff Replaceable by AI</label>
                                            <input
                                                type="number"
                                                id="aiReplaceCount"
                                                name="aiReplaceCount"
                                                value={formData.aiReplaceCount}
                                                onChange={handleInputChange}
                                                placeholder="2"
                                                className="input-highlight block w-full sm:text-sm border-gray-300 rounded-md"
                                                aria-describedby="aiReplaceCount-desc"
                                            />
                                            {errors.aiReplaceCount && <p className="error-message">{errors.aiReplaceCount}</p>}
                                            <p className="mt-1 text-sm text-gray-500" id="aiReplaceCount-desc">Number of positions that could be automated.</p>
                                        </div>
                                    )}
                                    <div>
                                        <label htmlFor="hasIP" className="block text-sm font-medium text-gray-700 mb-1">Do You Have Intellectual Property (IP)?</label>
                                        <select
                                            id="hasIP"
                                            name="hasIP"
                                            value={formData.hasIP}
                                            onChange={handleInputChange}
                                            className="input-highlight block w-full pl-3 pr-10 py-2 text-base border-gray-300 rounded-md"
                                            aria-describedby="hasIP-desc"
                                        >
                                            <option value="">--Select--</option>
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                        {errors.hasIP && <p className="error-message">{errors.hasIP}</p>}
                                        <p className="mt-1 text-sm text-gray-500" id="hasIP-desc">Select 'Yes' if you own patents or trademarks.</p>
                                    </div>
                                    {formData.hasIP === 'yes' && (
                                        <>
                                            <div>
                                                <label htmlFor="ipValue" className="block text-sm font-medium text-gray-700 mb-1">IP Value ($)</label>
                                                <div className="relative rounded-md shadow-sm">
                                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                        <span className="text-gray-500 sm:text-sm">$</span>
                                                    </div>
                                                    <input
                                                        type="text"
                                                        id="ipValue"
                                                        name="ipValue"
                                                        value={formData.ipValue}
                                                        onChange={handleInputChange}
                                                        placeholder="50,000.00"
                                                        className="input-highlight block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                                        aria-describedby="ipValue-desc"
                                                    />
                                                </div>
                                                {errors.ipValue && <p className="error-message">{errors.ipValue}</p>}
                                                <p className="mt-1 text-sm text-gray-500" id="ipValue-desc">Realistic valuation of your IP assets.</p>
                                            </div>
                                            <div>
                                                <label htmlFor="ipUnique" className="block text-sm font-medium text-gray-700 mb-1">Is the IP Unique?</label>
                                                <select
                                                    id="ipUnique"
                                                    name="ipUnique"
                                                    value={formData.ipUnique}
                                                    onChange={handleInputChange}
                                                    className="input-highlight block w-full pl-3 pr-10 py-2 text-base border-gray-300 rounded-md"
                                                    aria-describedby="ipUnique-desc"
                                                >
                                                    <option value="">--Select--</option>
                                                    <option value="unique">Completely Unique</option>
                                                    <option value="variation">Variation of Another Idea</option>
                                                </select>
                                                {errors.ipUnique && <p className="error-message">{errors.ipUnique}</p>}
                                                <p className="mt-1 text-sm text-gray-500" id="ipUnique-desc">Specify the uniqueness of your IP.</p>
                                            </div>
                                        </>
                                    )}
                                    <div>
                                        <label htmlFor="operationalEfficiency" className="block text-sm font-medium text-gray-700 mb-1">Operational Efficiency (1-10)</label>
                                        <div className="flex items-center">
                                            <input
                                                type="range"
                                                id="operationalEfficiency"
                                                name="operationalEfficiency"
                                                min="1"
                                                max="10"
                                                value={formData.operationalEfficiency}
                                                onChange={handleInputChange}
                                                className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                            />
                                            <span className="ml-3 text-sm font-medium text-gray-700">{formData.operationalEfficiency}</span>
                                        </div>
                                        <p className="mt-1 text-sm text-gray-500">Rate your operational efficiency (1 = Inefficient, 10 = Highly Efficient).</p>
                                    </div>
                                </div>
                                <div className="flex justify-between mt-6">
                                    <button
                                        onClick={handlePrevious}
                                        className="btn-secondary font-bold py-2 px-6 rounded-lg"
                                    >
                                        <i className="fas fa-arrow-left mr-2"></i> Previous
                                    </button>
                                    <button
                                        onClick={handleNext}
                                        className="btn-primary text-white font-bold py-2 px-6 rounded-lg"
                                    >
                                        Next <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        );
                    case 6:
                        return (
                            <div className={`step ${step === 6 ? 'step-visible' : 'step-hidden'}`}>
                                <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                    <i className="fas fa-chart-line mr-2 text-teal-500"></i> Future Projections
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {[
                                        { id: 'projectedRevenue', label: 'Projected Revenue Next Year ($)', placeholder: '150,000.00', desc: 'Expected revenue for the next fiscal year.', prefix: '$' },
                                        { id: 'expectedGrowthRate', label: 'Expected Annual Growth Rate (%)', placeholder: '10.00', desc: 'Anticipated revenue growth rate.', suffix: '%' }
                                    ].map(field => (
                                        <div key={field.id}>
                                            <label htmlFor={field.id} className="block text-sm font-medium text-gray-700 mb-1">{field.label}</label>
                                            <div className="relative rounded-md shadow-sm">
                                                {field.prefix && (
                                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                        <span className="text-gray-500 sm:text-sm">{field.prefix}</span>
                                                    </div>
                                                )}
                                                <input
                                                    type="text"
                                                    id={field.id}
                                                    name={field.id}
                                                    value={formData[field.id]}
                                                    onChange={handleInputChange}
                                                    placeholder={field.placeholder}
                                                    className={`input-highlight block w-full ${field.prefix ? 'pl-7' : ''} ${field.suffix ? 'pr-12' : ''} sm:text-sm border-gray-300 rounded-md`}
                                                    aria-describedby={`${field.id}-desc`}
                                                />
                                                {field.suffix && (
                                                    <div className="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                        <span className="text-gray-500 sm:text-sm">{field.suffix}</span>
                                                    </div>
                                                )}
                                            </div>
                                            {errors[field.id] && <p className="error-message">{errors[field.id]}</p>}
                                            <p className="mt-1 text-sm text-gray-500" id={`${field.id}-desc`}>{field.desc}</p>
                                        </div>
                                    ))}
                                    {formData.valuationMethods.includes('dcf') && (
                                        <div className="col-span-2">
                                            <h3 className="text-lg font-semibold text-gray-800 mb-4">Discounted Cash Flow (DCF) Inputs</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                {[
                                                    { id: 'cashFlow1', label: 'Year 1 Cash Flow ($)', placeholder: '50,000.00' },
                                                    { id: 'cashFlow2', label: 'Year 2 Cash Flow ($)', placeholder: '55,000.00' },
                                                    { id: 'cashFlow3', label: 'Year 3 Cash Flow ($)', placeholder: '60,000.00' },
                                                    { id: 'cashFlow4', label: 'Year 4 Cash Flow ($)', placeholder: '65,000.00' },
                                                    { id: 'cashFlow5', label: 'Year 5 Cash Flow ($)', placeholder: '70,000.00' },
                                                    { id: 'discountRate', label: 'Discount Rate (%)', placeholder: '10.00', suffix: '%' },
                                                    { id: 'terminalGrowthRate', label: 'Terminal Growth Rate (%)', placeholder: '3.00', suffix: '%' }
                                                ].map(field => (
                                                    <div key={field.id}>
                                                        <label htmlFor={field.id} className="block text-sm font-medium text-gray-700 mb-1">{field.label}</label>
                                                        <div className="relative rounded-md shadow-sm">
                                                            {field.prefix && (
                                                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                                    <span className="text-gray-500 sm:text-sm">$</span>
                                                                </div>
                                                            )}
                                                            <input
                                                                type="text"
                                                                id={field.id}
                                                                name={field.id}
                                                                value={formData[field.id]}
                                                                onChange={handleInputChange}
                                                                placeholder={field.placeholder}
                                                                className={`input-highlight block w-full ${field.prefix ? 'pl-7' : ''} ${field.suffix ? 'pr-12' : ''} sm:text-sm border-gray-300 rounded-md`}
                                                                aria-describedby={`${field.id}-desc`}
                                                            />
                                                            {field.suffix && (
                                                                <div className="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                                    <span className="text-gray-500 sm:text-sm">{field.suffix}</span>
                                                                </div>
                                                            )}
                                                        </div>
                                                        {errors[field.id] && <p className="error-message">{errors[field.id]}</p>}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    {formData.valuationMethods.includes('earnings') && (
                                        <div className="col-span-2">
                                            <h3 className="text-lg font-semibold text-gray-800 mb-4">Earnings-Based Valuation Inputs</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <label htmlFor="assets" className="block text-sm font-medium text-gray-700 mb-1">Total Assets ($)</label>
                                                    <div className="relative rounded-md shadow-sm">
                                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                            <span className="text-gray-500 sm:text-sm">$</span>
                                                        </div>
                                                        <input
                                                            type="text"
                                                            id="assets"
                                                            name="assets"
                                                            value={formData.assets}
                                                            onChange={handleInputChange}
                                                            placeholder="300,000.00"
                                                            className="input-highlight block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                                            aria-describedby="assets-desc"
                                                        />
                                                    </div>
                                                    {errors.assets && <p className="error-message">{errors.assets}</p>}
                                                    <p className="mt-1 text-sm text-gray-500" id="assets-desc">Total value of all assets owned.</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <div className="flex justify-between mt-6">
                                    <button
                                        onClick={handlePrevious}
                                        className="btn-secondary font-bold py-2 px-6 rounded-lg"
                                    >
                                        <i className="fas fa-arrow-left mr-2"></i> Previous
                                    </button>
                                    <button
                                        onClick={calculateValuation}
                                        className="btn-primary text-white font-bold py-2 px-6 rounded-lg"
                                    >
                                        Calculate Valuation <i className="fas fa-calculator ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        );
                    default:
                        return null;
                }
            };

            return (
                <section id="valuation" className="py-16 bg-gray-50">
                    <div className="container mx-auto px-6">
                        <div className="text-center mb-12">
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Get Your Business Valuation in 15 Minutes</h2>
                            <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                                Use our advanced valuation tool to assess your business worth with detailed insights and actionable recommendations.
                            </p>
                        </div>
                        <div className="bg-white rounded-xl shadow-lg overflow-hidden max-w-6xl mx-auto">
                            <div className="p-6 border-b border-gray-200">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-xl font-semibold text-gray-800">Step {step} of {totalSteps}</h3>
                                    <button
                                        onClick={handleStartOver}
                                        className="text-teal-500 hover:text-teal-600 font-medium flex items-center"
                                    >
                                        <i className="fas fa-redo-alt mr-2"></i> Start Over
                                    </button>
                                </div>
                                <div className="progress-bar">
                                    <div className="progress-fill" style={{ width: `${(step / totalSteps) * 100}%` }}></div>
                                </div>
                            </div>
                            <div className="p-6">
                                {results ? (
                                    <>
                                        <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                            <div className="p-6">
                                                <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">Business Valuation Results</h2>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                                    <div className="bg-teal-50 p-4 rounded-lg">
                                                        <h3 className="text-lg font-semibold text-teal-800 mb-2">Key Financial Metrics</h3>
                                                        <div className="space-y-2">
                                                            <p><span className="font-medium">Projected Revenue:</span> ${results.financialMetrics.projectedRevenue.toLocaleString()}</p>
                                                            <p><span className="font-medium">Net Earnings:</span> ${results.financialMetrics.netEarnings.toLocaleString()}</p>
                                                            <p><span className="font-medium">LTV/CAC Ratio:</span> {results.financialMetrics.ltvCacRatio.toFixed(2)}</p>
                                                            <p><span className="font-medium">Churn Rate:</span> {results.financialMetrics.churnRate}%</p>
                                                            <p><span className="font-medium">Growth Rate:</span> {results.financialMetrics.growthRate}%</p>
                                                        </div>
                                                    </div>
                                                    <div className="bg-green-50 p-4 rounded-lg">
                                                        <h3 className="text-lg font-semibold text-green-800 mb-2">Valuation Ranges</h3>
                                                        <div className="space-y-2">
                                                            {results.valuations.map(v => (
                                                                <p key={v.method}>
                                                                    <span className="font-medium">{v.method}:</span> ${Math.round(v.min).toLocaleString()} - ${Math.round(v.max).toLocaleString()}
                                                                </p>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="bg-yellow-50 p-4 rounded-lg mb-8">
                                                    <h3 className="text-lg font-semibold text-yellow-800 mb-2">Final Valuation</h3>
                                                    <div className="text-center">
                                                        <p className="text-3xl font-bold text-gray-800">${Math.round(results.avgValuation).toLocaleString()}</p>
                                                        <p className="text-sm text-gray-600 mt-2">Based on selected methods</p>
                                                    </div>
                                                </div>
                                                <div className="bg-purple-50 p-4 rounded-lg">
                                                    <h3 className="text-lg font-semibold text-purple-800 mb-2">Valuation Factors</h3>
                                                    <div className="space-y-2">
                                                        {results.valuationDetails.map((detail, i) => (
                                                            <p key={i} className="text-sm">{detail}</p>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="flex justify-center mt-6 gap-4">
                                                    <button
                                                        onClick={exportResults}
                                                        className="btn-primary text-white font-bold py-2 px-6 rounded-lg"
                                                    >
                                                        <i className="fas fa-file-export mr-2"></i> Export Results
                                                    </button>
                                                    <button
                                                        onClick={saveProgress}
                                                        className="btn-secondary font-bold py-2 px-6 rounded-lg"
                                                    >
                                                        <i className="fas fa-save mr-2"></i> Save Progress
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="mt-8 bg-white rounded-xl shadow-lg overflow-hidden">
                                            <div className="p-6">
                                                <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">Valuation Analysis Charts</h2>
                                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                                    <div className="bg-white p-4 rounded-lg border border-gray-200">
                                                        <h3 className="text-lg font-semibold text-gray-800 mb-4">Valuation Comparison</h3>
                                                        <div className="chart-container">
                                                            <canvas id="valuationChart"></canvas>
                                                        </div>
                                                    </div>
                                                    <div className="bg-white p-4 rounded-lg border border-gray-200">
                                                        <h3 className="text-lg font-semibold text-gray-800 mb-4">Staff Comparison</h3>
                                                        <div className="chart-container">
                                                            <canvas id="staffChart"></canvas>
                                                        </div>
                                                    </div>
                                                   
